<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="width=device-width, initial-scale=1.0">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Home</title>
    <link rel="stylesheet" href="css/home.css">
    <link rel="stylesheet" href="css/loader.css">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Sharp" rel="stylesheet">
    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Sharp:opsz,wght,FILL,GRAD@48,400,0,0" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/css/bootstrap.min.css"
        integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <script src="https://code.highcharts.com/highcharts.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://github.com/devongovett/pdfkit/releases/download/v0.10.0/pdfkit.standalone.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" />

</head>

<body>
    <div class="containerr" id="conta">

        <aside>
            <div class="top">
                <div class="logo">
                    <img src="img/logo.png">
                    <h2 class="sec">Light <span class="primary">Area</span> </h2>
                </div>
                <div class="close" id="close-btn">
                    <span class="material-symbols-sharp"> close</span>
                </div>
            </div>

            <div class="sidebar">
                <a href="#" class="active" id="home_btn">
                    <span class="material-symbols-sharp">grid_view</span>
                    <h3>Home</h3>
                </a>
                <a href="#" id="course-btn">
                    <span class="material-symbols-sharp">import_contacts</span>
                    <h3>Courses </h3>
                </a>
                <a href="#" id="wallet-btn">
                    <span class="material-symbols-sharp">account_balance_wallet</span>
                    <h3>Wallet</h3>
                </a>
                <a href="#" id="report-btn">
                    <span class="material-symbols-sharp">feed</span>
                    <h3>Reports</h3>
                </a>
                <a href="#" id="setting-btn">
                    <span class="material-symbols-sharp">settings</span>
                    <h3>Setting</h3>
                </a>
                <a href="#" id="logout-btn">
                    <span class="material-symbols-sharp">logout</span>
                    <h3>Logout </h3>
                </a>
            </div>
        </aside>
        <!---- END OF ASIDE ---->

        <!---- start OF home ---->
        <main id="home">
            <h1>Dashboard</h1>

            <div class="insights">

                <div class="income">
                    <span class="material-symbols-sharp">analytics</span>
                    <div class="middle">
                        <div class="left">
                            <h3>Total income</h3>
                            <h1 id="income">{analtyics}</h1>
                        </div>

                    </div>

                </div>
                <!------------------Last of income----------------->
                <div class="subscribers">
                    <span class="material-symbols-sharp">subscriptions</span>
                    <div class="middle">
                        <div class="left">
                            <h3>Total subscribers</h3>
                            <h1 id="sub">{analtycis}</h1>
                        </div>
                    </div>

                </div>
                <!------------------Last of subscrinbers----------------->
                <div class="followers">
                    <span class="material-symbols-sharp">person</span>
                    <div class="middle">
                        <div class="left">
                            <h3>Total Followers</h3>
                            <h1 id="follow">{analtycis}</h1>
                        </div>
                    </div>
                </div>
            </div>
            <!-------End of insights------------->
            <div class="charts">
                <h2>Total subscriptions </h2>
                <div class="date">
                    <select>
                        <option value="0">today</option>
                        <option value="1">This week</option>
                        <option value="2">this month</option>
                        <option value="3">all time</option>

                    </select>
                </div>
                <div id="chart" style="width:100%; height: 250px;"></div>
            </div>
            <!----End of charts--->
        </main>
        <div id="home-right" class="right">
            <div class="top">
                <button id="menu-btn">
                    <span class="material-symbols-sharp">menu</span>
                </button>
                <div class="theme-toggler">
                    <span class="material-symbols-sharp active">light_mode</span>
                    <span class="material-symbols-sharp">dark_mode</span>
                </div>
                <div class="profile">
                    <div class="info">
                        <p>Hello Mr <b id="name">{Teacher name}</b></p>
                        <small class="text_muted">Teacher</small>
                    </div>
                    <div class="profile-photo">
                        <img id="profile-img" src="img/logo.png">
                    </div>
                </div>
            </div>
            <!--end of profile-->
            <div class="recent-updates">
                <h2>Recent Updates</h2>
                <div class="updates">
                    <div class="update">
                        <div class="profile-photo">
                            <img src="img/logo.png">
                        </div>
                        <div class="message">
                            <p><b>{user name}</b> subcruibed to {course name}</p>
                            <small class="text-muted">2 Min ago</small>
                        </div>
                    </div>
                    <div class="update">
                        <div class="profile-photo">
                            <img src="img/logo.png">
                        </div>
                        <div class="message">
                            <p><b>{user name}</b> subcruibed to {course name}</p>
                            <small class="text-muted">2 Min ago</small>
                        </div>
                    </div>
                    <div class="update">
                        <div class="profile-photo">
                            <img src="img/logo.png">
                        </div>
                        <div class="message">
                            <p><b>{user name}</b> subcruibed to {course name}</p>
                            <small class="text-muted">2 Min ago</small>
                        </div>
                    </div>
                    <div class="update">
                        <div class="profile-photo">
                            <img src="img/logo.png">
                        </div>
                        <div class="message">
                            <p><b>{user name}</b> subcruibed to {course name}</p>
                            <small class="text-muted">2 Min ago</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!----END OF home----->

        <!---- start OF course ---->
        <main id="course">
            <div class="container  mb-5">

                <nav class="navbar navbar-expand-lg navbar-light bg-light">
                    <div class="container-fluid">


                        <div class="collapse navbar-collapse" id="navbarSupportedContent">

                            <button class="btn btn-primary curo">
                                Number of courses <span class="badge" id="course_count"></span>
                            </button>
                            <div class="searchh">
                                <input class="form-control me-2" type="search" placeholder="Search" aria-label="Search">
                                <button class="btn btn-primary" id="search_course">Search</button>
                            </div>
                            <a href="#" class="active" id="pop_up">
                                <span class="material-symbols-sharp">library_add</span>
                                <h3>ADD</h3>
                            </a>


                        </div>
                    </div>
                </nav>

                <!----course pop up----->
                <div id="myModal" class="modall">
                    <!-- Modal content -->
                    <div class="modal-contentt">
                        <span class="closee">&times;</span>
                        <form>
                            <div class="form-row">
                                <div class="form-group col-md-6">
                                    <label for="inputEmail4">Course Name</label>
                                    <input type="text" class="form-control" id="course_name" placeholder="اسم الكورس">
                                    <p class="validation" id="course_name_validation">Course Name must be filled out</p>
                                </div>
                                <div class="form-group col-md-6">
                                    <label for="inputPassword4">Price</label>
                                    <input type="text" class="form-control" id="course_price" placeholder="سعر الكورس">
                                    <p class="validation" id="price_validation">Price must be filled out</p>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="inputAddress">Course Description</label>
                                <input type="text" class="form-control" id="course_desc" placeholder="وصف الكورس">
                                <p class="validation" id="course_description_validation">Course Description must be
                                    filled out</p>
                            </div>
                            <div class="form-row">
                                <div class="form-group col-md-6">
                                    <label for="inputState">Catagory</label>
                                    <select id="cat_Select" class="form-control">
                                    </select>
                                    <p class="validation" id="catagory_validation">Catagory must be filled out</p>
                                </div>
                                <div class="form-group col-md-6" id="hidecat">
                                    <label for="inputState">Sub Catagory</label>
                                    <select id="inputState" class="form-control" disabled>
                                        <option selected value="">NA</option>

                                    </select>

                                </div>


                                <div class="form-group col-md-6" id="subcat">
                                    <label for="inputState">Sub Catagory</label>
                                    <select id="subbcat" class="form-control">
                                    </select>
                                    <p class="validation" id="sub_catagory_validation">Sub Catagory must be filled out
                                    </p>
                                </div>
                            </div>
                            <div class="form-group">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" value="false" id="checksale">
                                    <label class="form-check-label" for="flexCheckDefault">
                                        يمكن للموزعين بيع الكورس الخاص بك ؟
                                    </label>
                                </div>
                            </div>
                            <div class="form-group">
                                <h2 class="mb-5 text-center">Course Image</h2>


                                <label class="text-center mb-5 image-preview-wrapper" for="file-uploader">
                                    <img src="https://via.placeholder.com/300x300/efefef?text=Avatar" id="course_img"
                                        alt="image-placehoder" class="img-thumbnail" data-target="image-preview">
                                    <p class="validation" id="image_catagory_validation">Course Image must be filled out
                                    </p>
                                    <div class="spinner-wrapper position-absolute" data-target="spinner">
                                        <div class="spinner-border text-secondary" role="status">
                                            <span class="sr-only">Loading...</span>
                                        </div>
                                    </div>
                                </label>


                                <div class="row">
                                    <div class="col-12 col-md-6 mx-auto" id="flex">
                                        <div class="custom-file">
                                            <input accept="image/*" type="file" class="custom-file-input"
                                                id="file-uploader">
                                            <label class="custom-file-label" for="customFile">Choose
                                                file</label>

                                        </div>
                                    </div>
                                </div>

                            </div>

                            <div class="form-groupp">
                                <button id="addcourse" class="btn btn-primary">Add Course</button>

                            </div>

                        </form>
                    </div>

                </div>
                <!----cards----->
                <div class="media_list_lec" id="listingCourse">
                    <h2 class="empty">لا يوجد محاضرات الرجاء قم بأضافة محاضرات </h2>
                </div>

                <nav class="pigi">
                    <div class="pagination">
                        <li class="page-item">
                            <button class="page-link " id="prev-btn"><span class="material-symbols-sharp">
                                    arrow_back
                                </span></button>
                        </li>
                        <li class="page-item">
                            <button class="page-link" id="next-btn"><span
                                    class="material-symbols-sharp">arrow_forward</span></button>
                        </li>
                    </div>
                </nav>
                <!----end of cards----->
            </div>
        </main>

        <main id="lectures">

            <ul class="breadcrumbb">
                <li><a href="#" id="course_lec_btn">Courses</a></li>
                <li><a href="#" class="lec_id2" id="lec_id"></a></li>
                <li><a href="#" class="active">Lectures</a></li>
            </ul>

            <div class="content">
                <div class="flex">
                    <a href="#" id="add_video" class="btn btn-primary">أضافة محاضرة</a>
                    <a href="#" id="add_pdf" class="btn btn-primary"> PDF أضافة </a>
                    <a href="#" id="quiz_add" class="btn btn-primary">أضافة امتحان</a>
                </div>
                <button class="tablink" onclick="openPage('Home',this)" id="defaultOpen">Videos</button>
                <button class="tablink" onclick="openPage('News', this)">Pdf</button>
                <button class="tablink" onclick="openPage('Contact' ,this)">Quizez</button>

                <!----add lec pop up----->
                <div id="myModal_lec" class="modall">
                    <!-- Modal content -->
                    <div class="modal-content_lec">
                        <span class="close_lec" id="close_lec" data-bs-toggle="modal"
                            data-bs-target="#exampleModal">&times;</span>
                        <form>

                            <div class="form-group">
                                <label for="inputEmail4">lecture title</label>
                                <input type="text" class="form-control" id="lec_name" placeholder="عنوان المحاضره">
                                <p class="validation" id="lec_name_validation">Lecture title Name must be filled out
                                </p>
                            </div>
                            <div class="form-group">
                                <label for="inputAddress">Lecture Description</label>
                                <input type="text" class="form-control" id="lec_desc" placeholder="وصف المحاضرة">
                                <p class="validation" id="lec_description_validation">Lecture Description must be
                                    filled out</p>
                            </div>

                            <div class="form-group">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" value="false" id="checkScreenShot">
                                    <label class="form-check-label" for="flexCheckDefault">
                                        يمكن تصوير الشاشة ؟
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" value="false" id="checkfree">
                                    <label class="form-check-label" for="flexCheckDefault">
                                        الفديو مجاني ؟
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" value="true" id="checkNotifi"
                                        checked>
                                    <label class="form-check-label" for="flexCheckDefault">
                                        ارسال اشعار لجميع المشتركين في الكورس ؟
                                    </label>
                                </div>
                            </div>
                            <div>
                                <div id="drop_zone">Drop Files Here</div>
                                <label class="btn btn-block btn-info">
                                    Browse&hellip; <input id="browse" type="file" style="display: none;"
                                        accept="video/*">
                                </label>
                            </div>
                            <div id="progress-container" class="progress">
                                <div id="progress" class="progress-bar progress-bar-info progress-bar-striped active"
                                    role="progressbar" aria-valuenow="46" aria-valuemin="0" aria-valuemax="100"
                                    style="width: 0%">&nbsp;0%
                                </div>
                            </div>
                            <div class="form-group" id="grid">
                                <button id="addLecture" type="button" class="btn btn-primary">Add Lecture</button>

                            </div>


                        </form>
                    </div>

                </div>
                <!----edit lec pop up----->
                <div id="myModal_lec_edit" class="modallll">
                    <!-- Modal content -->
                    <div class="modal-contenttt">
                        <span class="close_lec_edit" id="close_lec_edit">&times;</span>
                        <form>

                            <div class="form-group">
                                <label for="inputEmail4">lecture title</label>
                                <input type="text" class="form-control" id="lec_name_edit" placeholder="عنوان المحاضره">
                                <p class="validation" id="lec_name_validation_edit">Lecture title Name must be
                                    filled out
                                </p>
                            </div>
                            <div class="form-group">
                                <label for="inputAddress">Lecture Description</label>
                                <input type="text" class="form-control" id="lec_desc_edit" placeholder="وصف المحاضرة">
                                <p class="validation" id="lec_description_validation_edit">Lecture Description must
                                    be
                                    filled out</p>
                            </div>

                            <div class="form-group">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" value="false"
                                        id="checkScreenShot_edit">
                                    <label class="form-check-label" for="flexCheckDefault">
                                        يمكن تصوير الشاشة ؟
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" value="false" id="checkfree_edit">
                                    <label class="form-check-label" for="flexCheckDefault">
                                        الفديو مجاني ؟
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" value="true" id="checkNotifi_edit"
                                        checked>
                                    <label class="form-check-label" for="flexCheckDefault">
                                        ارسال اشعار لجميع المشتركين في الكورس ؟
                                    </label>
                                </div>
                            </div>

                            <div class="form-group" id="grid">
                                <button id="editLecture" type="button" class="btn btn-primary">Update Lecture</button>
                            </div>



                        </form>
                    </div>

                </div>
                <!----delete lec pop up----->
                <div id="myModal_lec_delete">
                    <!-- Modal content -->
                    <div class="modal-contentttt">
                        <span class="close_lec_delete" id="close_lec_delete">&times;</span>
                        <form>

                            <h1>Delete Lecture</h1>
                            <p>Are you sure you want to delete this Lecture?</p>

                            <div class="clearfix">
                                <button type="button" id="cancel" class="cancelbtn">Cancel</button>
                                <button type="button" id="delete" class="deletebtn">Delete</button>
                            </div>

                        </form>
                    </div>

                </div>
                <!----preview video pop up----->
                <div id="myModal_video" class="modalll">
                    <!-- Modal content -->
                    <div class="modal-contenttt">
                        <span class="close_video" id="close_video">&times;</span>
                        <div class="container">
                            <h1 id="video_name"></h1>
                            <p id="video_desc"></p>
                            <div id="video_Div">

                            </div>
                        </div>

                    </div>

                </div>
                <!----add lec exit comfrim  pop up----->
                <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel"
                    aria-hidden="true">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="exampleModalLabel">Modal title</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal"
                                    aria-label="Close"></button>
                            </div>
                            <div class="modal-body">
                                are you sure you want to exit ?

                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-primary" id="exit_lec">EXIT</button>
                                <button type="button" class="btn btn-blue" data-bs-dismiss="modal">Continue</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!----add pdf pop up----->
                <div id="myModal_pdf" class="add_modal_pdf">
                    <!-- Modal content -->
                    <div class="modal-content_pdf">
                        <span class="close_pdf" id="close_pdf" data-bs-toggle="modal"
                            data-bs-target="#exampleModalpdf">&times;</span>
                        <form>

                            <div class="form-group" style="text-align:center ;">
                                <label for="inputEmail4">Pdf title</label>
                                <input type="text" class="form-control" id="pdf_name" placeholder="عنوان المستند">
                                <p class="validation" id="pdf_name_validation">Pdf Name must be filled out
                                </p>
                            </div>
                            <div class="form-group">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" value="false" id="checkPdfDownloaf">
                                    <label class="form-check-label" for="flexCheckDefault">
                                        هل يمكن للطالب تحميل الملف ؟
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" value="true" id="CheckPdfPrev">
                                    <label class="form-check-label" for="flexCheckDefault">
                                        هل الملف مجاني للطلاب الغير مسجلين بالكورس ؟
                                    </label>
                                </div>
                            </div>
                            <div>
                                <div id="drop_zone_pdf">Drop Files Here</div>
                                <div id="flexa7a" class="flex">
                                    <h4 id="pagesss" style="text-align: center;"></h4> : عدد الصفح
                                </div>

                                <label class="btn btn-block btn-info">
                                    Browse&hellip; <input id="browse_pdf" type="file" style="display: none;"
                                        accept=".pdf">
                                </label>
                            </div>
                            <div id="progress-container_pdf" class="progress">
                                <div id="progress_pdf"
                                    class="progress-bar progress-bar-info progress-bar-striped active"
                                    role="progressbar" aria-valuenow="46" aria-valuemin="0" aria-valuemax="100"
                                    style="width: 0%">&nbsp;0%
                                </div>

                            </div>

                            <div class="form-group" id="grid">
                                <button id="addPdf" type="button" class="btn btn-primary">Add Pdf</button>
                            </div>



                        </form>
                    </div>

                </div>
                <!----add pdf exit comfrim  pop up----->
                <div class="modal fade" id="exampleModalpdf" tabindex="-1" aria-labelledby="exampleModalLabel"
                    aria-hidden="true">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="exampleModalLabelpdf">Exit</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal"
                                    aria-label="Close"></button>
                            </div>
                            <div class="modal-body">
                                Are you sure you want to exit ?

                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-primary" id="exit_pdf">EXIT</button>
                                <button type="button" class="btn btn-blue" data-bs-dismiss="modal">Continue</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!----edit pdf pop up----->
                <div id="myModal_pdf_edit" class="edit_modal_pdf">
                    <!-- Modal content -->
                    <div class="modal-content_pdf">
                        <span class="close_pdf_edit" id="close_pdf_edit">&times;</span>
                        <form>

                            <div class="form-group" style="text-align:center ;">
                                <label for="inputEmail4">Pdf title</label>
                                <input type="text" class="form-control" id="pdf_name_edit" placeholder="عنوان المستند">
                                <p class="validation" id="pdf_name_validation_edit">Pdf Name must be filled out
                                </p>
                            </div>
                            <div class="form-group">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" value="false"
                                        id="checkPdfDownloaf_edit">
                                    <label class="form-check-label" for="flexCheckDefault">
                                        هل يمكن للطالب تحميل الملف ؟
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" value="true" id="CheckPdfPrev_edit">
                                    <label class="form-check-label" for="flexCheckDefault">
                                        هل الملف مجاني للطلاب الغير مسجلين بالكورس ؟
                                    </label>
                                </div>
                            </div>


                            <div class="form-group" id="grid">
                                <button type="button" id="editpdf" class="btn btn-primary">Update Lecture</button>
                            </div>



                        </form>
                    </div>

                </div>

                <!----delete pdf pop up----->
                <div id="myModal_pdf_delete">
                    <!-- Modal content -->
                    <div class="modal-contentttt">
                        <span class="close_pdf_delete" id="close_pdf_delete">&times;</span>
                        <form>

                            <h1>Delete pdf</h1>
                            <p>Are you sure you want to delete this pdf?</p>

                            <div class="clearfix">
                                <button type="button" id="cancel_pdf" class="cancelbtn_pdf">Cancel</button>
                                <button type="button" id="delete_pdf" class="deletebtn_pdf">Delete</button>
                            </div>

                        </form>
                    </div>

                </div>

                <!----add quiz pop up----->


                <!----add quiz pop up----->
                <div id="myModal_quizzz" class="add_modal_quizzz">
                    <!-- Modal content -->
                    <div class="modal-content_quizzz">
                        <span class="close_quizzz" id="close_quizzz" data-bs-toggle="modal"
                            data-bs-target="#exampleModalquiz">&times;</span>
                        <form id="quiz_elements">


                            <div class="form-group" style="text-align:center ;">
                                <label for="inputEmail4">quiz title</label>
                                <input type="text" class="form-control" id="quiz_name" placeholder="عنوان الامتحان">
                                <p class="validation" id="quiz_name_validation">Quiz title must be filled out
                                </p>
                            </div>
                            <div class="form-group">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" value="false" id="enroll">
                                    <label class="form-check-label" for="flexCheckDefault">
                                        هل الامتحان يتطلب التسجيل بالكورس ؟
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" value="true" id="repeat">
                                    <label class="form-check-label" for="flexCheckDefault">
                                        هل يمكن اعادة الامتحان ؟
                                    </label>
                                </div>

                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" value="true" id="time">
                                    <label class="form-check-label" for="flexCheckDefault">
                                        هل الامتحان وقت معين ؟
                                    </label>
                                </div>
                            </div>


                            <div class="form-group" id="quiz_time_div" style="text-align:center ;">
                                <label for="inputEmail4">Quiz time</label>
                                <input type="text" class="form-control" id="quiz_time" placeholder="الوقت بالدقايق">
                                <p class="validation" id="quiz_time_validation">Quiz Time must be filled out
                                </p>

                            </div>

                            <div class="form-group" id="grid">
                                <button type="button" id="Next_quiz" class="btn btn-primary">Next</button>
                            </div>


                        </form>
                    </div>

                </div>

                <!----add quiz exit comfrim  pop up----->
                <div class="modal fade" id="exampleModalquiz" tabindex="-1" aria-labelledby="exampleModalLabel"
                    aria-hidden="true">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="exampleModalLabelpdf">Exit</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal"
                                    aria-label="Close"></button>
                            </div>
                            <div class="modal-body">
                                Are you sure you want to exit ?

                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-primary" id="exit_quiz">EXIT</button>
                                <button type="button" class="btn btn-blue" data-bs-dismiss="modal">Continue</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!----Preview quiz  pop up----->
                <div id="preview_quiz_info" class="preview_quiz_info">
                    <div class="info_box">
                        <div class="info_title">
                            <span>Some rule of this quiz</span>
                        </div>
                        <div class="info_list">
                            <div class="info" id="quiz_info_time">1. You will have only <span
                                    id="quiz_time_prev">10</span> minutes to finish
                                this
                                Quiz</div>
                            <div class="info">2. You can't select any option once time goes off</div>
                            <div class="info">3. You will get points basis of your correct answer </div>
                        </div>
                        <div class="buttons">
                            <button class="quit" id="quit_quiz">Later</button>
                            <button class="resteart" id="start_quiz">Start</button>
                        </div>
                    </div>
                </div>
                <div id="preview_quiz_box" class="preview_quiz_box">
                    <div class="quiz_box">
                        <header>
                            <div class="title" id="quiz_prev_title">Quiz title</div>
                            <div class="timer" id="quiz_prev_timer">
                                <div class="time_text">Time Left</div>
                                <div class="time_min"><span id="time_left">9</span>min</div>
                            </div>
                        </header>
                        <section>
                            <div class="que_text">
                                <span>what's first developer ?</span>
                            </div>
                            <div class="option_list">
                                <div class="option">
                                    <span class="option_1"> fdfds</span>
                                </div>
                                <div class="option">
                                    <span class="option_2"> sdfdsf</span>
                                </div>
                                <div class="option">
                                    <span class="option_3"> ssadsvxz</span>
                                </div>
                                <div class="option">
                                    <span class="option_4"> gfdgfdgd</span>
                                </div>
                            </div>
                        </section>
                        <footer>
                            <div class="total_que">
                                <span>
                                    <p id="current_quiz_count">1</p>of<p id="total_count">5</p> Questions
                                </span>
                            </div>
                            <div class="buttons">
                                <button class="quit" id="quit_score">Finish</button>
                                <button class="resteart" id="next_btn_quiz">Next</button>
                            </div>
                        </footer>
                    </div>
                </div>
                <div id="preview_quiz_res" class="preview_quiz_res">
                    <div class="result_box">
                        <div class="icon">
                            <span class="material-symbols-sharp">workspace_premium</span>
                        </div>
                        <div class="complete_text">You've Complete the Quiz!</div>
                        <div class="score_text">
                            <span>Congratlations you got <p id="your_Score">2</p> Out of <p id="total_score">5</p>
                            </span>
                        </div>
                        <div class="buttons">
                            <button class="quit" id="quiz_end">End</button>
                        </div>
                    </div>
                </div>

                <!----edit quiz pop up----->
                <div id="myModal_quiz_edit" class="edit_modal_quiz">
                    <!-- Modal content -->
                    <div class="modal-content_quizzz">
                        <span class="close_quiz_edit" id="close_quiz_edit">&times;</span>
                        <form id="quiz_edit_elements">


                            <div class="form-group" style="text-align:center ;">
                                <label for="inputEmail4">quiz title</label>
                                <input type="text" class="form-control" id="quiz_name_edit"
                                    placeholder="عنوان الامتحان">
                                <p class="validation" id="quiz_name_validation_edit">Quiz title must be filled out
                                </p>
                            </div>
                            <div class="form-group" id="quiz_time_div_edit" style="text-align:center ;">
                                <label for="inputEmail4">Quiz time</label>
                                <input type="text" class="form-control" id="quiz_time_edit"
                                    placeholder="الوقت بالدقايق">
                                <p class="validation" id="quiz_time_validation_edit">Quiz Time must be filled out
                                </p>
                            </div>
                            <div class="form-group">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" value="false" id="enroll_edit">
                                    <label class="form-check-label" for="flexCheckDefault">
                                        هل الامتحان يتطلب التسجيل بالكورس ؟
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" value="true" id="repeat_edit">
                                    <label class="form-check-label" for="flexCheckDefault">
                                        هل يمكن اعادة الامتحان ؟
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" value="true" id="time_edit">
                                    <label class="form-check-label" for="flexCheckDefault">
                                        هل الامتحان وقت معين ؟
                                    </label>
                                </div>
                            </div>




                            <div class="form-group" id="flex_between">
                                <button type="button" id="edit_questions" class="btn btn-primary">Edit
                                    Questions</button>
                                <button type="button" id="update_quiz" class="btn btn-primary">Save</button>
                            </div>


                        </form>
                    </div>



                </div>



                <div id="Home" class="tabcontent">


                    <div class="media_list_lec" id="video_list">
                        <h2 class="empty">لا يوجد محاضرات الرجاء قم بأضافة محاضرات </h2>
                    </div>
                    <ul class="breadcrumbb centerr" id="lec_Arrow">
                        <li><a href="#" id="current_page"></a></li>
                        <li><a href="#" class="active" id="pages"></a></li>
                    </ul>
                    <nav class="pigi" id="lec_pigi">
                        <div class="pagination">
                            <li class="page-item">
                                <button class="page-link " id="prev-btn_lec"><span class="material-symbols-sharp">
                                        arrow_back
                                    </span></button>
                            </li>
                            <li class="page-item">
                                <button class="page-link" id="next-btn_lec"><span
                                        class="material-symbols-sharp">arrow_forward</span></button>
                            </li>
                        </div>
                    </nav>
                </div>
                <div id="News" class="tabcontent">

                    <div class="media_list_lec" id="pdf_list">
                        <h2 class="empty">لا يوجد مستندات الرجاء قم بأضافة مستند </h2>
                    </div>




                    <ul class="breadcrumbb centerr" id="pdf_Arrow">
                        <li><a href="#" id="current_page_pdf"></a></li>
                        <li><a href="#" class="active" id="pages_pdf"></a></li>
                    </ul>
                    <nav class="pigi" id="pdf_pigi">
                        <div class="pagination">
                            <li class="page-item">
                                <button class="page-link " id="prev-btn_pdf"><span class="material-symbols-sharp">
                                        arrow_back
                                    </span></button>
                            </li>
                            <li class="page-item">
                                <button class="page-link" id="next-btn_pdf"><span
                                        class="material-symbols-sharp">arrow_forward</span></button>
                            </li>
                        </div>
                    </nav>
                </div>
                <div id="Contact" class="tabcontent">

                    <div class="media_quiz_lec" id="quiz_list">
                        <h2 class="empty">لا يوجد امتحان الرجاء قم بأضافة امتحان </h2>
                    </div>




                    <ul class="breadcrumbb centerr" id="quiz_Arrow">
                        <li><a href="#" id="current_page_quiz"></a></li>
                        <li><a href="#" class="active" id="pages_quiz"></a></li>
                    </ul>
                    <nav class="pigi" id="quiz_pigi">
                        <div class="pagination">
                            <li class="page-item">
                                <button class="page-link " id="prev-btn_quiz"><span class="material-symbols-sharp">
                                        arrow_back
                                    </span></button>
                            </li>
                            <li class="page-item">
                                <button class="page-link" id="next-btn_quiz"><span
                                        class="material-symbols-sharp">arrow_forward</span></button>
                            </li>
                        </div>
                    </nav>
                </div>

            </div>





        </main>
        <!----END OF course----->

        <!---- start OF wallet ---->
        <main id="wallet"></main>
        <!----END OF wallet----->

        <!---- start OF report ---->
        <main id="report"></main>
        <!----END OF report----->

        <!---- start OF settings ---->
        <main id="setting"></main>
        <!----END OF settings----->







    </div>




    <div class="loader-wrapper">
        <span class="loader"><span class="loader-inner"></span></span>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-A3rJD856KowSb7dwlZdYEkO39Gagi7vIsF0jrRAoQmDKKtQBHUuLZ9AsSv4jD4Xa"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/js/bootstrap.min.js"
        integrity="sha384-ODmDIVzN+pFdexxHEHFBQH3/9/vQ9uori45z4JjnFsRydbmQbmL5t1tQ0culUzyK"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/js/bootstrap.min.js"
        integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa"
        crossorigin="anonymous"></script>
    <script src="javascript/dark-toggle.js"></script>
    <script src="javascript/loader.js"></script>
    <script src="javascript/home.js"></script>
    <script type="text/javascript" src="javascript/vimeo-upload-js.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf-lib/1.17.1/pdf-lib.min.js"></script>
    <script src="https://mozilla.github.io/pdf.js/build/pdf.js"></script>
    <script src="https://github.com/devongovett/pdfkit/releases/download/v0.10.0/pdfkit.standalone.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.12.313/pdf.min.js"></script>
    <script src="https://unpkg.com/pdf-lib@1.4.0/dist/pdf-lib.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/pdf-lib@1.4.0/dist/pdf-lib.min.js"></script>


    <script type="module">

        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-app.js";
        import {
            getAuth,
            createUserWithEmailAndPassword,
            signInWithEmailAndPassword,
            signOut,
            GoogleAuthProvider,
            signInWithRedirect,
            getRedirectResult,
            signInWithPopup,
            deleteUser,
            FacebookAuthProvider,
            onAuthStateChanged
        } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-auth.js";
        import { getFirestore, collection, where, getDocs, doc, query, getDoc, addDoc, setDoc, updateDoc, deleteDoc } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore.js";
        import { getDatabase, set, ref, update } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-database.js";
        import { getStorage, ref as sRef, uploadBytes, getDownloadURL, uploadBytesResumable } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-storage.js";
        // Your web app's Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCHMPzqBiDTGmOA1T2DavAaludCOiPb2Qk",
            authDomain: "light-area-ee9d2.firebaseapp.com",
            databaseURL: "https://light-area-ee9d2-default-rtdb.firebaseio.com",
            projectId: "light-area-ee9d2",
            storageBucket: "light-area-ee9d2.appspot.com",
            messagingSenderId: "327935716338",
            appId: "1:327935716338:web:712ee051f28488a3ce196b",
            measurementId: "G-EM9YV97BK7"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth();
        const db = getFirestore(app);
        const storage = getStorage();
        const database = getDatabase(app);
        const logout_btn = document.querySelector("#logout-btn");
        let course_card_perpage = 4;
        let current_corse_page = 1;
        let video_per_page = 4;
        let current_video_page = 1;
        let pdf_per_page = 4;
        let current_pdf_page = 1;
        let quiz_per_page = 4;
        let current_quiz_page = 1;
        var current_choise_index = 1;
        var question_number = 1;
        var quiz_data = { courseid: "", name: "", repeatbool: false, timerbool: false, time: 0, freebool: false, date: new Date(), examtake: 0, quizcount: 0 };
        var question_arr = [];
        var quiz_preview_data = { time: "", count: "", name: "", repeat: false, free: false, timer: false }
        var question_arr_prev = [];
        var current_choise_index_edit;
        // ======================== functions ===============================================

        // ======================== Home functions ===============================================

        //returent current user id
        function userUid() {
            return new Promise((resolve, reject) => {
                const userr = onAuthStateChanged(auth, (user) => {
                    if (user) {
                        // User is signed in, see docs for a list of available properties
                        // https://firebase.google.com/docs/reference/js/firebase.User

                        const uidd = user.uid;
                        console.log(uidd);
                        resolve(uidd);
                    } else {
                        // User is signed out
                        alert("الرجاء قم بتسجيل الدخول مره اخري");
                        location.replace("../Login.html");

                    }
                    userr();
                });
            })

        }
        const user_uid = await userUid();
        // set user data in home tab

        async function getUserData(id) {
            const docRef = doc(db, "users", id);
            const docSnap = await getDoc(docRef);
            if (docSnap.exists()) {


                const listofsubs = docSnap.data().totalSubscribers;
                const followers = Object.keys(listofsubs).length;
                document.getElementById("income").innerHTML = docSnap.data().income;
                document.getElementById("sub").innerHTML = docSnap.data().totalSubscribers;
                document.getElementById("follow").innerHTML = followers;
                document.getElementById("name").innerHTML = docSnap.data().userName;
                document.getElementById("profile-img").src = docSnap.data().ppUrl;

            } else {
                // doc.data() will be undefined in this case
                console.log("No such document!");
            }

        }
        getUserData(user_uid);
        //logout
        logout_btn.addEventListener('click', () => {
            signOut(auth).then(() => {
                // Sign-out successful.
                location.replace("../Login.html");
            }).catch((error) => {
                // An error happened.
            });
        })





        // ======================== courses functions ==============================================================================================

        // passin a query it return an arry of object with sanpshot values  
        function retrivequiers(queryy) {
            async function geta() {

                let arr = []
                const querySnapshott = await getDocs(queryy);
                querySnapshott.forEach((doc) => {
                    // doc.data() is never undefined for query doc snapshots

                    arr.push(doc.data());
                });
                return arr;
            }
            function getb() {
                return new Promise(function (resolve) {
                    resolve(geta());
                });
            };

            return getb();
        }
        const teacher_course_query = query(collection(db, "courses"), where("instructorId", "==", user_uid));
        let courses_Data = await retrivequiers(teacher_course_query);

        // get courser and render it 



        function rendercourse(page = 1) {
            var coursehtml = "";



            if (page == 1) {
                document.getElementById("prev-btn").style.visibility = "hidden"
            } else {
                document.getElementById("prev-btn").style.visibility = "visible"
            }
            if (page == numberofpage()) {
                document.getElementById("next-btn").style.visibility = "hidden"
            } else {
                document.getElementById("next-btn").style.visibility = "visible"
            }



            courses_Data.filter((row, index) => {
                let start = (current_corse_page - 1) * course_card_perpage;
                let end = (current_corse_page * course_card_perpage);
                if (index >= start && index < end) return true;
            }).forEach(course => {
                if (course.subscribers == undefined) {
                    course.subscribers = 0;
                }



                coursehtml += " <div class=\"media_lec\"> "
                coursehtml += ' <a href=\"#\"  id=\"opencourse\"  onclick=\" gotolect(\'' + course.id + '\')\"' + 'class=\"course\">'
                coursehtml += '<img class=\"media-object_lec\" src=\"' + course.picUrl + '\" alt=\"Sample photo\">'

                coursehtml += '</a>'
                coursehtml += '<div class=\"media-body_lec\">'
                coursehtml += '<h3 class=\"media-heading_lec\">' + course.courseName + '</h3>'
                coursehtml += '<p>' + course.desc + '</p>'
                coursehtml += '</div>'
                coursehtml += '<ul class=\"list-inline m-0\">'
                coursehtml += '<li class=\"list-inline-item\">'
                coursehtml += '<button class=\"editlec btn btn-success btn-sm rounded-0\" type=\"button\" title=\"Edit\" onclick=\"edit_course(\'' + course.id + '\')\"' + '><span class=\"material-symbols-sharp\">edit</span></button>'
                coursehtml += '</li>'
                coursehtml += '<li class=\"list-inline-item\">'
                coursehtml += '<button class=\"btn btn-danger btn-sm rounded-0\" id="delete_course" type=\"button\" title=\"Delete\" onclick=\"deletecourse(\'' + course.id + '\')\"' + '><span class=\"material-symbols-sharp\">delete</span></button>'
                coursehtml += '</li>'
                coursehtml += '</ul>'
                coursehtml += "</div>"
            })
            document.getElementById("listingCourse").innerHTML = coursehtml;
            document.getElementById("course_count").innerHTML = courses_Data.length;
        }
        rendercourse();

        //handle course pages next and prev arrow
        function previouspage() {
            if (current_corse_page > 1) {
                current_corse_page--;
            }
            rendercourse(current_corse_page);
        }
        function nextpage() {
            if ((current_corse_page * course_card_perpage) < courses_Data.length) {
                current_corse_page++;
            }
            rendercourse(current_corse_page);
        }
        function numberofpage() {
            return Math.ceil(courses_Data.length / course_card_perpage);
        }
        document.querySelector('#prev-btn').addEventListener('click', previouspage, false);
        document.querySelector('#next-btn').addEventListener('click', nextpage, false);



        // get the catgories and set it in the spinner in add course form
        const cargories = query(collection(db, "mainCategory"));
        let catgory_data = await retrivequiers(cargories);


        // passing id of select tag it fills it from array

        function fillselect(selectid, array) {
            var select = document.getElementById(selectid);
            for (var i = 0; i < array.length; i++) {
                var opt = array[i].name;
                var el = document.createElement("option");
                el.textContent = opt;
                el.value = array[i].id;
                select.appendChild(el);
            }
        }
        fillselect("cat_Select", catgory_data);

        // handle sup catgory on change of main catgory
        document.getElementById("cat_Select").addEventListener("change", myFunctionn);
        async function myFunctionn() {
            var selectBox = document.getElementById("cat_Select");
            var selectedValue = selectBox.value;
            var disbaledd = document.getElementById("hidecat");
            var subcatg = document.getElementById("subcat");
            const sub_catg = query(collection(db, "mainCategory", selectedValue, "subCategory"));
            let sub_catgory_data = await retrivequiers(sub_catg);
            console.log(sub_catgory_data);



            if (sub_catgory_data.length > 0) {
                disbaledd.style.display = "none";
                subcatg.style.display = "block";
                fillselect("subbcat", sub_catgory_data);
            }
            else {
                var selectBox = document.getElementById("subbcat");
                const select = document.querySelector('select');
                disbaledd.style.display = "block";
                subcatg.style.display = "none";
                var i, L = selectBox.options.length - 1;
                for (i = L; i >= 0; i--) {
                    selectBox.remove(i);
                }
            }
        }

        //vildate course form 
        function validateForm() {
            var checkdata = false;
            //inputs
            const course_name = document.getElementById("course_name");
            const course_price = document.getElementById("course_price");
            const course_desc = document.getElementById("course_desc");
            const course_catg = document.getElementById("cat_Select");
            const course_sub_catg = document.getElementById("subbcat");
            const course_img = document.getElementById("file-uploader");

            // validates 
            const course_name_validation = document.getElementById("course_name_validation");
            const course_price_validation = document.getElementById("price_validation");
            const course_desc_validation = document.getElementById("course_description_validation");
            const course_catg_validation = document.getElementById("catagory_validation");
            const course_sub_catg_validation = document.getElementById("sub_catagory_validation");
            const course_img_validation = document.getElementById("image_catagory_validation");

            if (course_name.value == "") {
                course_name_validation.style.display = "block";
                checkdata = false;
            }
            else {
                course_name_validation.style.display = "none";
                checkdata = true;
            }


            if (course_price.value == "") {
                course_price_validation.style.display = "block";
                checkdata = false;
            }
            else {
                course_price_validation.style.display = "none";
                checkdata = true;

            }


            if (course_desc.value == "") {
                course_desc_validation.style.display = "block";
                checkdata = false;
            }
            else {
                course_desc_validation.style.display = "none";
                checkdata = true;

            }


            if (course_catg.value == "" && course_catg.style.display == "block") {
                course_catg_validation.style.display = "block";
                checkdata = false;
            }
            else {
                course_catg_validation.style.display = "none";
                checkdata = true;

            }


            if (course_sub_catg.value == "") {
                course_sub_catg_validation.style.display = "block";
                checkdata = false;
            }
            else {
                course_sub_catg_validation.style.display = "none";
                checkdata = true;

            }


            if (course_img.files.length == 0) {
                course_img_validation.style.display = "block";
                checkdata = false;
            }
            else {
                course_img_validation.style.display = "none";
                checkdata = true;
            }
            return checkdata;
        }
        function CheckBox(element) {
            var check = false

            if (element.checked == true) {
                element.value = true;
            }
            if (element.checked == false) {
                element.value = false;
            }

        }

        //set Data to firestore
        async function upload_img() {
            return new Promise((resolve, reject) => {
                const fileSelector = document.getElementById('file-uploader').files[0];



                var storageRef = sRef(storage, 'courses/' + fileSelector.name);
                uploadBytes(storageRef, fileSelector).then((snapshot) => {
                    console.log('Uploaded a blob or file!');
                    getDownloadURL(snapshot.ref).then((downloadURL) => {
                        resolve(downloadURL);
                    });
                });
            });
        }
        async function set_data_to_firestore() {
            var chkBox = document.getElementById('checksale');
            CheckBox(chkBox);



            if (validateForm() == true) {
                const img_url = await upload_img();

                console.log(img_url);
                const sale = document.getElementById("checksale").value;
                const course_name = document.getElementById("course_name").value;
                const course_price = document.getElementById("course_price").value;
                const course_desc = document.getElementById("course_desc").value;
                const course_catg = document.getElementById("cat_Select").value;
                const course_sub_catg = document.getElementById("subbcat").value;

                const teacher_name = document.getElementById("name").innerHTML;
                const user_uid = await userUid();
                var sale_bool = (sale === "true");
                const docRef = await addDoc(collection(db, "courses"), {
                    active: false,
                    categoryId: course_catg,
                    courseName: course_name,
                    desc: course_desc,
                    instructor: teacher_name,
                    instructorId: user_uid,
                    picUrl: img_url,
                    price: parseInt(course_price),
                    subCategoryId: course_sub_catg,
                    canSell: sale_bool,

                });
                const idref = doc(db, "courses", docRef.id);
                await updateDoc(idref, {
                    id: docRef.id,
                });
                alert("تم اضافة الكورس بنجاح");
                document.getElementById("myModal").display.style = "none";

            }
            if (validateForm() == false) {
                return;
            }
        }
        document.getElementById("addcourse").onclick = async () => {
            await set_data_to_firestore();

        };

        //==================== lecture function ============
        $(document).on('click', '.course', async function () {

            let Course_id = sessionStorage.getItem("lec_id");
            //write course name 
            console.log(Course_id);
            const docRef = doc(db, "courses", Course_id);
            const docSnap = await getDoc(docRef);
            if (docSnap.exists()) {
                console.log(docSnap.data());
                document.getElementsByClassName("lec_id2")[0].innerHTML = docSnap.data().courseName;
            } else {
                // doc.data() will be undefined in this case
                console.log("No such document!");
            }



            // get course lecture data
            const course_videos_query = query(collection(db, "videos"), where("courseId", "==", Course_id));
            let courses_videos_Data = await retrivequiers(course_videos_query);
            // function that return cover img for a certing lecture video
            async function get_img_from_vemio(id) {
                return new Promise((resolve, reject) => {
                    $.getJSON('https://vimeo.com/api/oembed.json?url=https://vimeo.com/' + id, { format: "json" }, function (data) {

                        resolve(data.thumbnail_url);
                    });
                });
            }
            // function that return durtion for a certing lecture video
            async function get_video_durtion(id) {
                return new Promise((resolve, reject) => {
                    $.getJSON('https://vimeo.com/api/oembed.json?url=https://vimeo.com/' + id, { format: "json" }, function (data) {

                        resolve(data.duration);
                    });
                });
            }
            // convert sec to hours and min 
            function convertHMS(value) {
                const sec = parseInt(value, 10); // convert value to number if it's string
                let hours = Math.floor(sec / 3600); // get hours
                let minutes = Math.floor((sec - (hours * 3600)) / 60); // get minutes
                let seconds = sec - (hours * 3600) - (minutes * 60); //  get seconds
                // add 0 if value < 10; Example: 2 => 02
                if (hours < 10) { hours = "0" + hours; }
                if (minutes < 10) { minutes = "0" + minutes; }
                if (seconds < 10) { seconds = "0" + seconds; }
                return hours + ':' + minutes + ':' + seconds; // Return is HH : MM : SS
            }

            // handle and render lecture videos data preview videos
            function renderLec(page = 1) {
                var Lechtml = "";


                if (page == 1) {
                    document.getElementById("prev-btn_lec").style.visibility = "hidden"
                } else {
                    document.getElementById("prev-btn_lec").style.visibility = "visible"
                }
                if (page == numberofpageLec()) {

                    document.getElementById("next-btn_lec").style.visibility = "hidden"
                } else {
                    document.getElementById("next-btn_lec").style.visibility = "visible"
                }

                console.log(courses_videos_Data);
                if (courses_videos_Data.length == 0) {
                    Lechtml += "<h2 class=\"empty\">لا يوجد محاضرات الرجاء قم بأضافة محاضرات </h2>"
                    document.getElementById("video_list").innerHTML = Lechtml;
                    document.getElementById("lec_Arrow").style.display = "none";
                    document.getElementById("lec_pigi").style.display = "none";
                }
                else {
                    document.getElementById("lec_Arrow").style.display = "block";
                    document.getElementById("lec_pigi").style.display = "block";
                    courses_videos_Data.filter((row, index) => {
                        let start = (current_video_page - 1) * video_per_page;
                        let end = (current_video_page * video_per_page);
                        if (index >= start && index < end) return true;
                    }).forEach(async (video) => {

                        let arr = video.videoUrl.split("/");
                        var viemo_id = arr[3];
                        var img_url = await get_img_from_vemio(viemo_id);
                        var video_dur = await get_video_durtion(viemo_id);
                        var vide_lenght = convertHMS(video_dur);
                        console.log(vide_lenght);
                        console.log(img_url)
                        Lechtml += " <div class=\"media_lec\"> "
                        Lechtml += ' <a href=\"#\"  onclick=\" gottovideo(\'' + video.id + '\')\"' + 'class=\"VideoPopUp\">'
                        Lechtml += '<img class=\"media-object_lec\" src=\"' + img_url + '\" alt=\"Sample photo\">'
                        Lechtml += '<small class=\"text_muted\">' + vide_lenght + '</small>'
                        Lechtml += '</a>'
                        Lechtml += '<div class=\"media-body_lec\">'
                        Lechtml += '<h3 class=\"media-heading_lec\">' + video.title + '</h3>'
                        Lechtml += '<p>' + video.desc + '</p>'
                        Lechtml += '</div>'
                        Lechtml += '<ul class=\"list-inline m-0\">'
                        Lechtml += '<li class=\"list-inline-item\">'
                        Lechtml += '<button class=\"editlec btn btn-success btn-sm rounded-0\" type=\"button\" title=\"Edit\" onclick=\"editvideo(\'' + video.id + '\')\"' + '><span class=\"material-symbols-sharp\">edit</span></button>'
                        Lechtml += '</li>'
                        Lechtml += '<li class=\"list-inline-item\">'
                        Lechtml += '<button class=\"btn btn-danger btn-sm rounded-0\" id="delete_lec" type=\"button\" title=\"Delete\" onclick=\"deletevideo(\'' + video.id + '\')\"' + '><span class=\"material-symbols-sharp\">delete</span></button>'
                        Lechtml += '</li>'
                        Lechtml += '</ul>'
                        Lechtml += "</div>"
                        document.getElementById("video_list").innerHTML = Lechtml;

                    })
                    document.getElementById("pages").innerHTML = numberofpageLec();
                    document.getElementById("current_page").innerHTML = current_video_page;

                }
            }
            renderLec();
            function previouspageLec() {
                if (current_video_page > 1) {
                    current_video_page--;
                }
                renderLec(current_video_page);
            }
            function nextpageLec() {
                if ((current_video_page * video_per_page) < courses_videos_Data.length) {
                    current_video_page++;
                }
                renderLec(current_video_page);
            }
            function numberofpageLec() {

                return Math.ceil(courses_videos_Data.length / video_per_page);
            }
            document.querySelector('#prev-btn_lec').addEventListener('click', previouspageLec, false);
            document.querySelector('#next-btn_lec').addEventListener('click', nextpageLec, false);


            // handle and render pdf
            const course_pdf_query = query(collection(db, "courses", Course_id, "pdfs"));
            let courses_pdf_Data = await retrivequiers(course_pdf_query);
            function render_pdf(page = 1) {
                var pdfhtml = "";


                if (page == 1) {
                    document.getElementById("prev-btn_pdf").style.visibility = "hidden"
                } else {
                    document.getElementById("prev-btn_pdf").style.visibility = "visible"
                }
                if (page == numberofpagepdf()) {

                    document.getElementById("next-btn_pdf").style.visibility = "hidden"
                } else {
                    document.getElementById("next-btn_pdf").style.visibility = "visible"
                }

                console.log(courses_pdf_Data.length);
                if (courses_pdf_Data.length == 0) {
                    pdfhtml += "<h2 class=\"empty\">لا يوجد مستندات الرجاء قم بأضافة مستند </h2>"
                    document.getElementById("pdf_list").innerHTML = pdfhtml;
                    document.getElementById("pdf_Arrow").style.display = "none";
                    document.getElementById("pdf_pigi").style.display = "none";
                }
                else {
                    document.getElementById("pdf_Arrow").style.display = "block";
                    document.getElementById("pdf_pigi").style.display = "block";
                    courses_pdf_Data.filter((row, index_pdf) => {
                        let start_pdf = (current_pdf_page - 1) * pdf_per_page;
                        let end_pdf = (current_pdf_page * pdf_per_page);
                        if (index_pdf >= start_pdf && index_pdf < end_pdf) return true;
                    }).forEach(async (pdf) => {
                        if (pdf.thumb == "") {
                            pdfhtml += " <div class=\"media_lec\"> "
                            pdfhtml += ' <a href=\"' + pdf.pdfUrl + '\"  target="_blank" class=\"VideoPopUp\">'
                            pdfhtml += '<img class=\"media-object_lec\" src=\"https://firebasestorage.googleapis.com/v0/b/light-area-ee9d2.appspot.com/o/pdf-icon-11549528510ilxx4eex38.png?alt=media&token=dc31df1d-77a6-465b-9ce8-793b5c2e6d3f\" alt=\"Sample photo\">'
                            pdfhtml += '</a>'
                            pdfhtml += '<div class=\"media-body_lec\">'
                            pdfhtml += '<h3 class=\"media-heading_lec\">' + pdf.title + '</h3>'
                            pdfhtml += '</div>'
                            pdfhtml += '<ul class=\"list-inline m-0\">'
                            pdfhtml += '<li class=\"list-inline-item\">'
                            pdfhtml += '<button class=\"editpdf btn btn-success btn-sm rounded-0\" type=\"button\" title=\"Edit\" onclick=\"editPdf(\'' + pdf.id + '\')\"' + '><span class=\"material-symbols-sharp\">edit</span></button>'
                            pdfhtml += '</li>'
                            pdfhtml += '<li class=\"list-inline-item\">'
                            pdfhtml += '<button class=\"btn btn-danger btn-sm rounded-0\" id="delete_pdf" type=\"button\" title=\"Delete\" onclick=\"deletepdf(\'' + pdf.id + '\')\"' + '><span class=\"material-symbols-sharp\">delete</span></button>'
                            pdfhtml += '</li>'
                            pdfhtml += '</ul>'
                            pdfhtml += "</div>"
                        }
                        else {
                            pdfhtml += " <div class=\"media_lec\"> "
                            pdfhtml += ' <a href=\"' + pdf.pdfUrl + '\"  target="_blank" class=\"VideoPopUp\">'
                            pdfhtml += '<img class=\"media-object_lec\" src=\"' + pdf.thumb + '\" alt=\"Sample photo\">'
                            pdfhtml += '</a>'
                            pdfhtml += '<div class=\"media-body_lec\">'
                            pdfhtml += '<h3 class=\"media-heading_lec\">' + pdf.title + '</h3>'
                            pdfhtml += '</div>'
                            pdfhtml += '<ul class=\"list-inline m-0\">'
                            pdfhtml += '<li class=\"list-inline-item\">'
                            pdfhtml += '<button class=\"editpdf btn btn-success btn-sm rounded-0\" type=\"button\" title=\"Edit\" onclick=\"editPdf(\'' + pdf.id + '\')\"' + '><span class=\"material-symbols-sharp\">edit</span></button>'
                            pdfhtml += '</li>'
                            pdfhtml += '<li class=\"list-inline-item\">'
                            pdfhtml += '<button class=\"btn btn-danger btn-sm rounded-0\" id="delete_pdf" type=\"button\" title=\"Delete\" onclick=\"deletepdf(\'' + pdf.id + '\')\"' + '><span class=\"material-symbols-sharp\">delete</span></button>'
                            pdfhtml += '</li>'
                            pdfhtml += '</ul>'
                            pdfhtml += "</div>"

                        }
                        document.getElementById("pdf_list").innerHTML = pdfhtml;
                    })
                    document.getElementById("pages_pdf").innerHTML = numberofpagepdf();
                    document.getElementById("current_page_pdf").innerHTML = current_pdf_page;

                }
            }
            render_pdf();
            function previouspagepdf() {
                if (current_pdf_page > 1) {
                    current_pdf_page--;
                }
                render_pdf(current_pdf_page);
            }
            function nextpagepdf() {
                if ((current_pdf_page * pdf_per_page) < courses_pdf_Data.length) {
                    current_pdf_page++;
                }
                render_pdf(current_pdf_page);
            }
            function numberofpagepdf() {

                return Math.ceil(courses_pdf_Data.length / pdf_per_page);
            }
            document.querySelector('#prev-btn_pdf').addEventListener('click', previouspagepdf, false);
            document.querySelector('#next-btn_pdf').addEventListener('click', nextpagepdf, false);

            // handle and render quiz
            const course_quiz_query = query(collection(db, "courses", Course_id, "exams"));
            let courses_quiz_Data = await retrivequiers(course_quiz_query);
            function render_quiz(page = 1) {
                var quizhtml = "";


                if (page == 1) {
                    document.getElementById("prev-btn_quiz").style.visibility = "hidden"
                } else {
                    document.getElementById("prev-btn_quiz").style.visibility = "visible"
                }
                if (page == numberofpagequiz()) {

                    document.getElementById("next-btn_quiz").style.visibility = "hidden"
                } else {
                    document.getElementById("next-btn_quiz").style.visibility = "visible"
                }

                console.log(courses_quiz_Data.length);
                if (courses_quiz_Data.length == 0) {
                    quizhtml += "<h2 class=\"empty\">لا يوجد مستندات الرجاء قم بأضافة مستند </h2>"
                    document.getElementById("quiz_list").innerHTML = quizhtml;
                    document.getElementById("quiz_Arrow").style.display = "none";
                    document.getElementById("quiz_pigi").style.display = "none";
                }
                else {
                    document.getElementById("quiz_Arrow").style.display = "block";
                    document.getElementById("quiz_pigi").style.display = "block";
                    courses_quiz_Data.filter((row, index_quiz) => {
                        let start_quiz = (current_quiz_page - 1) * quiz_per_page;
                        let end_quiz = (current_quiz_page * quiz_per_page);
                        if (index_quiz >= start_quiz && index_quiz < end_quiz) return true;
                    }).forEach(async (quiz) => {

                        const question_quiz_query = query(collection(db, "courses", Course_id, "exams", quiz.id, "questions"));
                        let question_quiz_Data = await retrivequiers(question_quiz_query);
                        var quetions_count = question_quiz_Data.length;
                        quizhtml += " <div class=\"media_lec\"> "
                        quizhtml += ' <a href=\"#\" onclick=\" gottoquiz(\'' + quiz.id + '\')\"' + 'class=\"quizpopup\">'
                        quizhtml += '<img class=\"media-object_lec\" src=\"https://firebasestorage.googleapis.com/v0/b/light-area-ee9d2.appspot.com/o/quiz.png?alt=media&token=6ca9298b-30e9-4244-bf3c-4e993dee30dd\" alt=\"quiz photo\">'
                        quizhtml += '</a>'
                        quizhtml += '<div class=\"media-body_lec\">'
                        quizhtml += '<h3 class=\"media-heading_lec\">' + quiz.name + '</h3>'
                        quizhtml += '<small class=\"text_muted\">' + quetions_count + '<span> : عدد الاسئلة </span></small>'
                        quizhtml += '</div>'
                        quizhtml += '<ul class=\"list-inline m-0\">'
                        quizhtml += '<li class=\"list-inline-item\">'
                        quizhtml += '<button class=\"editquiz btn btn-success btn-sm rounded-0\" type=\"button\" title=\"Edit\" onclick=\"editquiz(\'' + quiz.id + '\')\"' + '><span class=\"material-symbols-sharp\">edit</span></button>'
                        quizhtml += '</li>'
                        quizhtml += '<li class=\"list-inline-item\">'
                        quizhtml += '<button class=\"btn btn-danger btn-sm rounded-0\" id="delete_quiz" type=\"button\" title=\"Delete\" onclick=\"deletequiz(\'' + quiz.id + '\')\"' + '><span class=\"material-symbols-sharp\">delete</span></button>'
                        quizhtml += '</li>'
                        quizhtml += '</ul>'
                        quizhtml += "</div>"


                        document.getElementById("quiz_list").innerHTML = quizhtml;
                    })
                    document.getElementById("pages_quiz").innerHTML = numberofpagequiz();
                    document.getElementById("current_page_quiz").innerHTML = current_quiz_page;

                }
            }
            render_quiz();
            function previouspagequiz() {
                if (current_quiz_page > 1) {
                    current_quiz_page--;
                }
                render_pdf(current_quiz_page);
            }
            function nextpagequiz() {
                if ((current_quiz_page * quiz_per_page) < courses_quiz_Data.length) {
                    current_quiz_page++;
                }
                render_quiz(current_quiz_page);
            }
            function numberofpagequiz() {

                return Math.ceil(courses_quiz_Data.length / quiz_per_page);
            }
            document.querySelector('#prev-btn_quiz').addEventListener('click', previouspagequiz, false);
            document.querySelector('#next-btn_quiz').addEventListener('click', nextpagequiz, false)


        });
        //video input
        var fileInput = document.getElementById('browse');
        var listFile = document.getElementById('drop_zone');
        fileInput.onchange = function () {
            listFile.innerHTML = fileInput.files[0].name;
        }
        //pdf input
        var fileInputPdf = document.getElementById('browse_pdf');
        var listFilePdf = document.getElementById('drop_zone_pdf');
        fileInputPdf.onchange = function () {
            listFilePdf.innerHTML = fileInputPdf.files[0].name;
        }

        //set lecture data to fire store
        function validate_lec() {
            var check_lec_data = false
            const lec_name = document.getElementById("lec_name");
            const lec_desc = document.getElementById("lec_desc");

            // validates 
            const lec_name_validation = document.getElementById("lec_name_validation");
            const lec_desc_validation = document.getElementById("lec_description_validation");

            if (lec_name.value == "") {
                lec_name_validation.style.display = "block";
                check_lec_data = false;
            }
            else {
                lec_name_validation.style.display = "none";
                check_lec_data = true;
            }


            if (lec_desc.value == "") {
                lec_desc_validation.style.display = "block";
                check_lec_data = false;
            }
            else {
                lec_desc_validation.style.display = "none";
                check_lec_data = true;

            }
            return check_lec_data;
        }
        async function set_lec_data_to_firestore(url) {
            var chkBox1 = document.getElementById('checkScreenShot');
            var chkBox2 = document.getElementById('checkfree');
            var chkBox3 = document.getElementById('checkNotifi');
            CheckBox(chkBox1);
            CheckBox(chkBox2);
            CheckBox(chkBox3);
            let Course_id = sessionStorage.getItem("lec_id");
            const course_videos_query = query(collection(db, "videos"), where("courseId", "==", Course_id));
            let courses_videos_Data = await retrivequiers(course_videos_query);


            if (validate_lec() == true) {
                const index = courses_videos_Data.length + 1;
                const lec_name = document.getElementById("lec_name").value;
                const lec_desc = document.getElementById("lec_desc").value;
                const SH_Check = document.getElementById("checkScreenShot").value;
                const free_Check = document.getElementById("checkfree").value;
                const notfi_Check = document.getElementById("checkNotifi").value;

                const user_uid = await userUid();
                var SH_Check_bool = (SH_Check === "true");
                var free_Check_bool = (free_Check === "true");
                var notfi_Check_bool = (notfi_Check === "true");
                const docRef = await addDoc(collection(db, "videos"), {
                    uId: user_uid,
                    courseId: Course_id,
                    sendNotification: notfi_Check_bool,
                    trial: free_Check_bool,
                    canRecord: SH_Check_bool,
                    desc: lec_desc,
                    title: lec_name,
                    sortValue: index,
                    duration: "",
                    videoUrl: url,
                });
                const idref = doc(db, "videos", docRef.id);
                await updateDoc(idref, {
                    id: docRef.id,
                });

            }
            if (validate_lec() == false) {
                return;
            }
        }
        async function videoupload() {
            var files = new Blob([document.getElementById("browse").files[0]], { "type": "video\/mp4" });

            var dropZone = document.getElementById('drop_zone');

            updateProgress(0)
            document.getElementById('progress-container').style.display = 'block'

            var uploader = new VimeoUpload({
                file: files,
                token: "1586ec9cdf6679c240d921d1eed5fed5",

                onError: async function (data) {
                    alert(data)

                },
                onProgress: function (data) {


                    updateProgress(data.loaded / data.total)
                },
                onComplete: async function (videoId, index) {
                    var url = 'https://vimeo.com/' + videoId

                    if (index > -1) {
                        /* The metadata contains all of the uploaded video(s) details see: https://developer.vimeo.com/api/endpoints/videos#/{video_id} */
                        url = this.metadata[index].link //

                        /* add stringify the json object for displaying in a text area */
                        var pretty = JSON.stringify(this.metadata[index], null, 2)

                        console.log(pretty) /* echo server data */
                    }
                    await set_lec_data_to_firestore(url);
                    alert("تم رفع المحاضره بنجاح");
                    document.getElementById("myModal_lec").style.display = "none";

                    //reset input values to null

                    document.getElementById("lec_name").value = ""
                    document.getElementById("lec_desc").value = ""
                    document.getElementById("checkScreenShot").value = false;
                    document.getElementById("checkfree").value = false;
                    document.getElementById("checkNotifi").value = true;
                    document.getElementById("checkScreenShot").checked == false;
                    document.getElementById("checkfree").checked == false;
                    document.getElementById("checkScreenShot").checked == false;
                    document.getElementById("progress-container").style.display = "none";
                    document.getElementById("progress").style.width = "0px";
                    document.getElementById("drop_zone").innerHTML = "Drop Files Here";


                }
            })
            uploader.upload();


            /**
             * Dragover handler to set the drop effect.
             */

            /**
            * Updat progress bar.
            */
            function updateProgress(progress) {
                progress = Math.ceil(progress * 100)
                var element = document.getElementById('progress')
                element.setAttribute('style', 'width:' + progress + '%')
                element.innerHTML = '&nbsp;' + progress + '%'
            }
            /**
             * Wire up drag & drop listeners once page loads
             */

            document.addEventListener('DOMContentLoaded', function () {
                var dropZone = document.getElementById('drop_zone')
                var browse = document.getElementById('browse')
                dropZone.addEventListener('dragover', handleDragOver, false)
                dropZone.addEventListener('drop', handleFileSelect, false)
                browse.addEventListener('change', handleFileSelect, false)
            })
        }
        document.getElementById("addLecture").onclick = async () => {
            videoupload()
        };


        // preview lecture in pop up
        $(document).on('click', '.VideoPopUp', async function () {
            let id = sessionStorage.getItem("vid_id");
            const videosnapshot = query(collection(db, "videos"), where("id", "==", id));
            let video_data = await retrivequiers(videosnapshot);
            let arr = video_data[0].videoUrl.split("/");
            var viemo_id = arr[3];
            document.getElementById("video_name").innerHTML = video_data[0].title;
            document.getElementById("video_desc").innerHTML = video_data[0].desc;
            document.getElementById("video_Div").innerHTML = '  <iframe id=\"videoframe\" src=\"https://player.vimeo.com/video/' + viemo_id + '\" width=\"700\" height=\"450\" frameborder=\"0\" title=\"' + video_data[0].title + '\" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe>'

        });
        document.getElementById("exit_lec").onclick = () => {
            var myModal = document.getElementById('exampleModal')
            window.videoupload = function () { return false; };
            document.getElementById("myModal_lec").style.display = "none";
            myModal.setAttribute("data-bs-dismiss", "modal");
            document.getElementById("exit_lec").click();
            //myModal.style.display="none";
        };


        $(document).on('click', '.editlec', async function () {

            var modal_edit_lec = document.getElementById("myModal_lec_edit");
            modal_edit_lec.style.display = "block";
            var current_video_id = sessionStorage.getItem("video_id");
            console.log(current_video_id);
            await setdata_to_edit_lecture_form(current_video_id);
        })
        async function setdata_to_edit_lecture_form(id) {
            const docReff = doc(db, "videos", id);
            const docSnap = await getDoc(docReff);
            if (docSnap.exists()) {
                console.log(docSnap.data());
                document.getElementById("lec_name_edit").value = docSnap.data().title;
                document.getElementById("lec_desc_edit").value = docSnap.data().desc;
                var trial = docSnap.data().trial;
                var canRecord = docSnap.data().canRecord;
                var sendNotification = docSnap.data().sendNotification;
                if (canRecord == true) {
                    document.getElementById("checkScreenShot_edit").checked = true;
                    document.getElementById("checkScreenShot_edit").value = true;
                }
                else {
                    document.getElementById("checkScreenShot_edit").checked = false;
                    document.getElementById("checkScreenShot_edit").value = false;
                }
                if (trial == true) {
                    document.getElementById("checkfree_edit").checked = true;
                    document.getElementById("checkfree_edit").value = true;
                }
                else {
                    document.getElementById("checkfree_edit").checked = false;
                    document.getElementById("checkfree_edit").value = false;
                }
                if (sendNotification == true) {
                    document.getElementById("checkNotifi_edit").checked = true;
                    document.getElementById("checkNotifi_edit").value = true;
                }
                else {
                    document.getElementById("checkNotifi_edit").checked = false;
                    document.getElementById("checkNotifi_edit").value = false;
                }
            } else {
                // doc.data() will be undefined in this case
                console.log("No such document!");
            }
        }
        // valdiate edit lecture form
        function validtion_Edit_lec() {
            var check_lec_edit = false
            const lec_name_edit = document.getElementById("lec_name_edit");
            const lec_desc_edit = document.getElementById("lec_desc_edit");

            // validates 
            const lec_name_validation_edit = document.getElementById("lec_name_validation_edit");
            const lec_desc_validation_edit = document.getElementById("lec_description_validation_edit");

            if (lec_name_edit.value == "") {
                lec_name_validation_edit.style.display = "block";
                check_lec_edit = false;
            }
            else {
                lec_name_validation_edit.style.display = "none";
                check_lec_edit = true;
            }


            if (lec_desc_edit.value == "") {
                lec_desc_validation_edit.style.display = "block";
                check_lec_edit = false;
            }
            else {
                lec_desc_validation_edit.style.display = "none";
                check_lec_edit = true;

            }
            return check_lec_edit;
        }
        document.getElementById("editLecture").onclick = async () => {
            var current_video_id = sessionStorage.getItem("video_id");
            var chkBox1 = document.getElementById('checkScreenShot_edit');
            var chkBox2 = document.getElementById('checkfree_edit');
            var chkBox3 = document.getElementById('checkNotifi_edit');
            CheckBox(chkBox1);
            CheckBox(chkBox2);
            CheckBox(chkBox3);
            if (validtion_Edit_lec() == true) {
                const video_ref = doc(db, "videos", current_video_id);
                const name = document.getElementById("lec_name_edit").value;
                const desc = document.getElementById("lec_desc_edit").value;
                const SH_Check = document.getElementById("checkScreenShot_edit").value;
                const free_Check = document.getElementById("checkfree_edit").value;
                const notfi_Check = document.getElementById("checkNotifi_edit").value;
                var SH_Check_bool = (SH_Check === "true");
                var free_Check_bool = (free_Check === "true");
                var notfi_Check_bool = (notfi_Check === "true");
                await updateDoc(video_ref, {
                    sendNotification: notfi_Check_bool,
                    trial: free_Check_bool,
                    canRecord: SH_Check_bool,
                    desc: desc,
                    title: name,
                });
                alert("تم تعديل المحاضره بنجاح");
                var modal_edit_lec = document.getElementById("myModal_lec_edit");
                modal_edit_lec.style.display = "none";
            }
            else {
                return;
            }
        };
        $(document).on('click', '.deletebtn', async function () {
            var lec_id = sessionStorage.getItem("video_id");
            var modal_Delete = document.getElementById('myModal_lec_delete');
            await deleteDoc(doc(db, "videos", lec_id));
            modal_Delete.style.display = "none";

            alert("تم مسح المحاضرة بنجاح ");
        });


        // add pdf 
        async function upload_pdf() {
            if (vlidatepdf() == true) {
                const fileSelector = document.getElementById('browse_pdf').files[0];
                let Course_id = sessionStorage.getItem("lec_id");
                updateProgressPdf(0)
                document.getElementById('progress-container_pdf').style.display = 'block'

                const pdf_fb_id = doc(collection(db, "courses", Course_id, "pdfs"));
                console.log(pdf_fb_id.id);


                var storageRef = sRef(storage, "courses/" + Course_id + "/" + pdf_fb_id.id + ".pdf");

                const uploadTask = uploadBytesResumable(storageRef, fileSelector);

                // Register three observers:
                // 1. 'state_changed' observer, called any time the state changes
                // 2. Error observer, called on failure
                // 3. Completion observer, called on successful completion
                uploadTask.on('state_changed',
                    (snapshot) => {
                        // Observe state change events such as progress, pause, and resume
                        // Get task progress, including the number of bytes uploaded and the total number of bytes to be uploaded
                        console.log(snapshot.bytesTransferred);
                        console.log(snapshot.totalBytes);
                        updateProgressPdf(snapshot.bytesTransferred / snapshot.totalBytes)

                    },
                    (error) => {

                    },
                    async () => {
                        // Handle successful uploads on complete
                        // For instance, get the download URL: https://firebasestorage.googleapis.com/...
                        getDownloadURL(uploadTask.snapshot.ref).then((downloadURL) => {
                            sessionStorage.setItem("pdf_link", downloadURL);
                            console.log("a7aaaaaaa");
                        });

                        var chkBox1 = document.getElementById('checkPdfDownloaf');
                        var chkBox2 = document.getElementById('CheckPdfPrev');
                        CheckBox(chkBox1);
                        CheckBox(chkBox2);


                        const pdf_name = document.getElementById("pdf_name").value;
                        const checkPdfDownloaf = document.getElementById('checkPdfDownloaf').value;
                        const CheckPdfPrev = document.getElementById('CheckPdfPrev').value;
                        const numPages = document.getElementById('pagesss').innerHTML;
                        const Course_id = sessionStorage.getItem("lec_id");
                        const downloadURL = sessionStorage.getItem("pdf_link");
                        console.log(downloadURL);
                        var datee = new Date();
                        var checkPdfDownloaf_bool = (checkPdfDownloaf === "true");
                        var CheckPdfPrev_bool = (CheckPdfPrev === "true");

                        const pdfref = await setDoc((db, pdf_fb_id), {
                            courseId: Course_id,
                            date: datee,
                            downloaded: checkPdfDownloaf_bool,
                            free: CheckPdfPrev_bool,
                            pageCount: parseInt(numPages),
                            title: pdf_name,
                            thumb: "",
                            id: pdf_fb_id.id,
                            pdfUrl: downloadURL,
                        });


                        alert("تم اضافة المستند بنجاح");
                        document.getElementById("pdf_name").value = "";
                        document.getElementById('checkPdfDownloaf').value = false;
                        document.getElementById('CheckPdfPrev').value = false;
                        document.getElementById('CheckPdfPrev').checked = false;
                        document.getElementById('checkPdfDownloaf').checked = false;
                        document.getElementById("myModal_pdf").style.display = "none";
                        document.getElementById('drop_zone_pdf').innerHTML = "Drop files here";
                        document.getElementById('pagesss').innerHTML = "";
                        document.getElementById("flexa7a").style.display = "none";




                    }
                );
            }
            else {
                return;
            }
        }
        function updateProgressPdf(progress) {
            progress = Math.ceil(progress * 100);
            console.log(progress);
            var element = document.getElementById('progress_pdf')
            element.setAttribute('style', 'width:' + progress + '%')
            element.innerHTML = '&nbsp;' + progress + '%'
        }
        function vlidatepdf() {
            var check_pdf_data = false
            const pdf_name = document.getElementById("pdf_name");


            // validates 
            const pdf_name_validation = document.getElementById("pdf_name_validation");

            if (pdf_name.value == "") {
                pdf_name_validation.style.display = "block";
                check_pdf_data = false;
            }
            else {
                pdf_name_validation.style.display = "none";
                check_pdf_data = true;
            }


            return check_pdf_data;
        }
        let inputElement = document.getElementById('browse_pdf')
        inputElement.onchange = function (event) {

            var file = event.target.files[0];
            document.getElementById("flexa7a").style.display = "flex";
            //Step 2: Read the file using file reader
            var fileReader = new FileReader();

            fileReader.onload = function () {

                //Step 4:turn array buffer into typed array
                var typedarray = new Uint8Array(this.result);

                //Step 5:pdfjs should be able to read this
                const loadingTask = pdfjsLib.getDocument(typedarray);
                loadingTask.promise.then(pdf => {
                    document.getElementById('drop_zone_pdf').innerHTML = file.name;
                    document.getElementById('pagesss').innerHTML = pdf.numPages;
                    // The document is loaded here...
                });


            };
            //Step 3:Read the file as ArrayBuffer
            fileReader.readAsArrayBuffer(file);
        }
        document.getElementById("addPdf").onclick = async () => {

            await upload_pdf();
        }

        //edit  pdf
        $(document).on('click', '.editpdf', async function () {

            var modal_edit_pdf = document.getElementById("myModal_pdf_edit");
            modal_edit_pdf.style.display = "block";
            var current_pdf_id = sessionStorage.getItem("pdf_id");
            await setdata_to_edit_pdf_form(current_pdf_id);
        })
        async function setdata_to_edit_pdf_form(id) {
            let Course_id = sessionStorage.getItem("lec_id");
            const docReff = doc(db, "courses", Course_id, 'pdfs', id);
            const docSnap = await getDoc(docReff);
            if (docSnap.exists()) {

                document.getElementById("pdf_name_edit").value = docSnap.data().title;
                var can_Download = docSnap.data().downloaded;
                var isFree = docSnap.data().free;
                console.log(isFree);
                console.log(can_Download);
                if (can_Download == true) {
                    document.getElementById("checkPdfDownloaf_edit").checked = true;
                    document.getElementById("checkPdfDownloaf_edit").value = true;
                }
                else {
                    document.getElementById("checkPdfDownloaf_edit").checked = false;
                    document.getElementById("checkPdfDownloaf_edit").value = false;
                }
                if (isFree == true) {
                    document.getElementById("CheckPdfPrev_edit").checked = true;
                    document.getElementById("CheckPdfPrev_edit").value = true;
                }
                else {
                    document.getElementById("CheckPdfPrev_edit").checked = false;
                    document.getElementById("CheckPdfPrev_edit").value = false;
                }
            } else {
                // doc.data() will be undefined in this case
                console.log("No such document!");
            }
        }
        // valdiate edit lecture form
        function validtion_Edit_pdf() {
            var check_pdf_edit = false
            const pdf_name_edit = document.getElementById("pdf_name_edit");

            // validates 
            const pdf_name_validation_edit = document.getElementById("pdf_name_validation_edit");


            if (pdf_name_edit.value == "") {
                pdf_name_validation_edit.style.display = "block";
                check_pdf_edit = false;
            }
            else {
                pdf_name_validation_edit.style.display = "none";
                check_pdf_edit = true;
            }

            return check_pdf_edit;
        }
        document.getElementById("editpdf").onclick = async () => {
            let Course_id = sessionStorage.getItem("lec_id");
            var current_pdf_id = sessionStorage.getItem("pdf_id");
            var chkBox1 = document.getElementById('checkPdfDownloaf_edit');
            var chkBox2 = document.getElementById('CheckPdfPrev_edit');

            CheckBox(chkBox1);
            CheckBox(chkBox2);
            console.log(validtion_Edit_pdf())
            if (validtion_Edit_pdf() == true) {
                const pdf_ref = doc(db, "courses", Course_id, 'pdfs', current_pdf_id);
                const name = document.getElementById("pdf_name_edit").value;

                const download_Check = document.getElementById("checkPdfDownloaf_edit").value;
                const free_Check = document.getElementById("CheckPdfPrev_edit").value;
                var free_Check_bool = (free_Check === "true");
                var download_Check_bool = (download_Check === "true");
                await updateDoc(pdf_ref, {
                    free: free_Check_bool,
                    downloaded: download_Check_bool,
                    title: name,
                });
                alert("تم تعديل المستند بنجاح");
                var modal_edit_pdf = document.getElementById("myModal_pdf_edit");
                modal_edit_pdf.style.display = "none";
            }
            else {
                return;
            }
        };
        document.getElementById("exit_pdf").onclick = () => {
            var myModal = document.getElementById('exampleModalpdf')
            window.upload_pdf = function () { return false; };
            document.getElementById("myModal_pdf").style.display = "none";
            myModal.setAttribute("data-bs-dismiss", "modal");
            document.getElementById("exit_pdf").click();
            //myModal.style.display="none";
        };
        $(document).on('click', '.deletebtn_pdf', async function () {
            var pdf_id = sessionStorage.getItem("pdf_id");
            var Course_id = sessionStorage.getItem("lec_id");
            var modal_Delete = document.getElementById('myModal_pdf_delete');
            await deleteDoc(doc(db, "courses", Course_id, "pdfs", pdf_id));
            modal_Delete.style.display = "none";
            alert("تم مسح المستند بنجاح ");
        });

        //quiz handle 

        // check box for time
        const checkbox = document.getElementById('time')

        $(document).on('change', '#time', function (event) {
            if (event.currentTarget.checked) {
                document.getElementById('quiz_time_div').style.display = "block"
            } else {
                document.getElementById('quiz_time_div').style.display = "none"
            }
        })
        $(document).on('change', '#time_edit', function (event) {
            if (event.currentTarget.checked) {
                document.getElementById('quiz_time_div_edit').style.display = "block"
            } else {
                document.getElementById('quiz_time_div_edit').style.display = "none"
            }
        })


        //exit comfrmition 
        document.getElementById("exit_quiz").onclick = () => {
            // set varibals of quiz to defualt 
            current_choise_index = 1;
            question_number = 1;
            quiz_data = { courseid: "", name: "", repeatbool: false, timerbool: false, time: 0, freebool: false, date: new Date(), examtake: 0, quizcount: 0 };
            question_arr = [];

            var form = document.getElementById("quiz_elements")
            var main_quiz_form = "<div class=\"form-group\" style=\"text-align:center ;\">"
            main_quiz_form += "<label for=\"inputEmail4\">quiz title</label>"
            main_quiz_form += "<input type=\"text\" class=\"form-control\" id=\"quiz_name\" placeholder=\"عنوان الامتحان\">"
            main_quiz_form += "<p class=\"validation\" id=\"quiz_name_validation\">Quiz title must be filled out </p>"
            main_quiz_form += "</div>"
            main_quiz_form += "<div class=\"form-group\">"
            main_quiz_form += "<div class=\"form-check\">"
            main_quiz_form += "<input class=\"form-check-input\" type=\"checkbox\" value=\"false\" id=\"enroll\">"
            main_quiz_form += "<label class=\"form-check-label\" for=\"flexCheckDefault\">"
            main_quiz_form += "هل الامتحان يتطلب التسجيل بالكورس ؟  </label>"
            main_quiz_form += "</div>"
            main_quiz_form += "<div class=\"form-check\">"
            main_quiz_form += "<input class=\"form-check-input\" type=\"checkbox\" value=\"false\" id=\"repeat\">"
            main_quiz_form += "<label class=\"form-check-label\" for=\"flexCheckDefault\">"
            main_quiz_form += "   هل يمكن اعادة الامتحان ؟ </label>"
            main_quiz_form += "</div>"
            main_quiz_form += "<div class=\"form-check\">"
            main_quiz_form += "<input class=\"form-check-input\" type=\"checkbox\" value=\"true\" id=\"time\">"
            main_quiz_form += "<label class=\"form-check-label\" for=\"flexCheckDefault\">"
            main_quiz_form += "هل الامتحان وقت معين ؟</label>"
            main_quiz_form += "</div>"
            main_quiz_form += "</div>"
            main_quiz_form += "<div class=\"form-group\" id=\"quiz_time_div\" style=\"text-align:center ;\">"
            main_quiz_form += "<label for=\"inputEmail4\">Quiz time</label>"
            main_quiz_form += "<input type=\"text\" class=\"form-control\" id=\"quiz_time\" placeholder=\"الوقت بالدقايق\">"
            main_quiz_form += "<p class=\"validation\" id=\"quiz_time_validation\">Quiz Time must be filled out</p>"
            main_quiz_form += "</div>"
            main_quiz_form += "<div class=\"form-group\" id=\"grid\">"
            main_quiz_form += "<button type=\"button\"  id=\"Next_quiz\" class=\"btn btn-primary\">Next</button>"
            main_quiz_form += "</div>"
            form.innerHTML = main_quiz_form;

            var myModal = document.getElementById('exampleModalquiz')
            window.upload_pdf = function () { return false; };
            document.getElementById("myModal_quizzz").style.display = "none";
            myModal.setAttribute("data-bs-dismiss", "modal");
            document.getElementById("exit_quiz").click();
            //myModal.style.display="none";
        };

        // when click add choice it apend a check box
        $(document).on('click', '#add_choices', function () {
            add_checkbox();
        })
        function add_checkbox() {


            var fieldset = document.getElementById("choices");

            const div = document.createElement("div");
            div.setAttribute("class", "form-check flex");

            const input_text = document.createElement("input");
            input_text.setAttribute("type", "text");
            input_text.setAttribute("class", "form-control");
            input_text.setAttribute("placeholder", "اختيار");
            input_text.setAttribute("id", "quiz_" + question_number + "_choise_" + current_choise_index);
            div.appendChild(input_text);

            const input_check = document.createElement("input");
            input_check.setAttribute("type", "radio");
            input_check.setAttribute("class", "form-check-input");
            input_check.setAttribute("name", "gridRadios");
            input_check.setAttribute("value", current_choise_index);
            input_check.setAttribute("id", "quiz_" + question_number + "_check_" + current_choise_index);
            div.appendChild(input_check);
            fieldset.appendChild(div);

            current_choise_index++;
        }


        // when click next in add quiz render question
        $(document).on('click', '#Next_quiz', function () {
            renderQuestion_first_time();
        })
        function renderQuestion_first_time() {
            var quiz_name_value = document.getElementById("quiz_name").value;

            var time_Check = document.getElementById("time");
            CheckBox(time_Check);
            var time_check_bool = (time_Check.value === "true");

            var enroll_Check = document.getElementById("enroll");
            CheckBox(enroll_Check);
            var enroll_Check_bool = (enroll_Check.value === "true");

            var repeat_Check = document.getElementById("repeat");
            CheckBox(repeat_Check);
            var repeat_Check_bool = (repeat_Check.value === "true");


            if (quiz_name_value != "" && validate_quiz_time() == true) {
                quiz_data.courseid = sessionStorage.getItem("lec_id");
                quiz_data.name = quiz_name_value;
                quiz_data.timerbool = time_check_bool;
                quiz_data.freebool = enroll_Check_bool;
                quiz_data.repeatbool = repeat_Check_bool;

                var form = document.getElementById("quiz_elements");
                var quiz = "<div class=\"form-group\" style=\"text-align:center ;\">"
                quiz += "<label for=\"inputEmail4\"><span id=\"quiz_counter\">" + question_number + "</span>: سؤال رقم </label>"
                quiz += "<input type=\"text\" class=\"form-control\" id=\"question_" + question_number + "\" placeholder=\"سؤال\">"
                quiz += "</div>"
                quiz += "<h4 class=\"right\">choices</h4>"
                quiz += "<fieldset id=\"choices\" class=\"form-group\">"
                quiz += "<div class=\"form-check flex\">"
                quiz += "<input type=\"text\" class=\"form-control\" id=\"quiz_" + question_number + "_choise_" + current_choise_index + "\" placeholder=\"اختيار\">"
                quiz += "<input class=\"form-check-input\" type=\"radio\" name=\"gridRadios\" id=\"quiz_" + question_number + "_check_" + current_choise_index + "\" value=\"" + current_choise_index + "\">"
                quiz += "</div>"
                current_choise_index++;
                quiz += "<div class=\"form-check flex\">"
                quiz += "<input type=\"text\" class=\"form-control\" id=\"quiz_" + question_number + "_choise_" + current_choise_index + "\" placeholder=\"اختيار\">"
                quiz += "<input class=\"form-check-input\" type=\"radio\" name=\"gridRadios\" id=\"quiz_" + question_number + "_check_" + current_choise_index + "\" value=\"" + current_choise_index + "\">"
                quiz += "</div>"
                current_choise_index++;
                quiz += "</fieldset>"
                quiz += "<a href=\"#\" id=\"add_choices\" class=\"ahref\">اضافة اختيار <span class=\"material-symbols-sharp\">add</span></a>"
                quiz += "<p class=\"validation\" id=\"quiz_validation\">All fields must be filled out</p>"
                quiz += "<div class=\"centertwo\">"
                quiz += "<button type=\"button\"  id=\"quiz_done\" class=\"btn btn-primary\">Finish quiz</button>"
                quiz += "<button id=\"add_more\" type=\"button\"  class=\"btn btn-primary\">add question</button>"
                quiz += "</div>"
                form.innerHTML = quiz;
                console.log(quiz_data);

            }
            else {

                if (quiz_name_value != "") {
                    document.getElementById("quiz_name_validation").style.display = "none";
                } else {
                    document.getElementById("quiz_name_validation").style.display = "block";
                }

            }

        }
        //validete quiz time input if user check the time checkbox
        function validate_quiz_time() {

            const checkbox = document.getElementById('time');
            const quiz_time_value = document.getElementById("quiz_time").value;
            if (checkbox.checked) {

                if (quiz_time_value != "") {

                    var valueInt = parseInt(quiz_time_value)
                    console.log(valueInt);
                    if (valueInt < 5 || valueInt > 100) {

                        document.getElementById("quiz_time_validation").innerHTML = " وقت للامتحان يتراوج من 5 دقائق الي 100 دقيقة";
                        document.getElementById("quiz_time_validation").style.display = "block";
                        return false;
                    }
                    else {
                        quiz_data.time = valueInt;
                        return true;
                    }
                } else {

                    document.getElementById("quiz_time_validation").innerHTML = "Quiz Time must be filled out";
                    document.getElementById("quiz_time_validation").style.display = "block"
                    return false;
                }
            }
            else {

                return true;
            }
        }

        // when click add question add more quetions
        $(document).on('click', '#add_more', function () {
            if (question_validation() == true) {
                if (radio_buttons_validation() == true) {
                    document.getElementById("quiz_validation").style.display = "none";
                    get_quiz_data();
                    add_question();
                }
                else {
                    document.getElementById("quiz_validation").innerHTML = "one check box at least must be cheacked";
                    document.getElementById("quiz_validation").style.display = "block";
                }
            }
            else {
                document.getElementById("quiz_validation").innerHTML = "All fields must be filled out";
                document.getElementById("quiz_validation").style.display = "block";
            }

        })
        function add_question() {
            question_number++;
            current_choise_index = 1;
            renderQuestion();
        }
        function renderQuestion() {

            var form = document.getElementById("quiz_elements");
            var quiz = "<div class=\"form-group\" style=\"text-align:center ;\">"
            quiz += "<label for=\"inputEmail4\"><span id=\"quiz_counter\">" + question_number + "</span>: سؤال رقم </label>"
            quiz += "<input type=\"text\" class=\"form-control\" id=\"question_" + question_number + "\" placeholder=\"سؤال\">"
            quiz += "</div>"
            quiz += "<h4 class=\"right\">choices</h4>"
            quiz += "<fieldset id=\"choices\" class=\"form-group\">"
            quiz += "<div class=\"form-check flex\">"
            quiz += "<input type=\"text\" class=\"form-control\" id=\"quiz_" + question_number + "_choise_" + current_choise_index + "\" placeholder=\"اختيار\">"
            quiz += "<input class=\"form-check-input\" type=\"radio\" name=\"gridRadios\" id=\"quiz_" + question_number + "_check_" + current_choise_index + "\" value=\"" + current_choise_index + "\">"
            quiz += "</div>"
            current_choise_index++;
            quiz += "<div class=\"form-check flex\">"
            quiz += "<input type=\"text\" class=\"form-control\" id=\"quiz_" + question_number + "_choise_" + current_choise_index + "\" placeholder=\"اختيار\">"
            quiz += "<input class=\"form-check-input\" type=\"radio\" name=\"gridRadios\" id=\"quiz_" + question_number + "_check_" + current_choise_index + "\" value=\"" + current_choise_index + "\">"
            quiz += "</div>"
            current_choise_index++;
            quiz += "</fieldset>"
            quiz += "<a href=\"#\" id=\"add_choices\" class=\"ahref\">اضافة اختيار <span class=\"material-symbols-sharp\">add</span></a>"
            quiz += "<p class=\"validation\" id=\"quiz_validation\">All fields must be filled out</p>"
            quiz += "<div class=\"centertwo\">"
            quiz += "<button  type=\"button\" id=\"quiz_done\" class=\"btn btn-primary\">Finish quiz</button>"
            quiz += "<button id=\"add_more\" type=\"button\"  class=\"btn btn-primary\">add question</button>"
            quiz += "</div>"
            form.innerHTML = quiz;
        }


        function question_validation() {

            var question_value = document.getElementById("question_" + question_number).value;
            var answers = new Array();
            var index = 1;


            for (let i = 0; i < current_choise_index - 1; i++) {

                var choice = document.getElementById("quiz_" + question_number + "_choise_" + index).value;
                answers.push(choice);
                index++;
            }


            for (var i = 0; i < answers.length; i++) {
                if (answers[i] === "") {
                    document.getElementById("quiz_validation").style.display = "block";
                    return false;
                }
            }
            if (question_value == "") {
                document.getElementById("quiz_validation").style.display = "block";
                return false;
            }
            document.getElementById("quiz_validation").style.display = "none";
            return true;

        }
        function radio_buttons_validation() {
            const radioButtons = document.querySelectorAll('input[name="gridRadios"]');
            for (const radioButton of radioButtons) {
                if (radioButton.checked) {
                    return true;
                }
            }

        }

        function get_quiz_data() {
            var obj = {};
            console.log(question_arr)
            const radioButtons = document.querySelectorAll('input[name="gridRadios"]');
            var question_value = document.getElementById("question_" + question_number).value;
            var index = 1;
            var correct_answer_index;
            var choicess = [];
            obj.question = question_value;

            for (let i = 0; i < current_choise_index - 1; i++) {
                var choice = document.getElementById("quiz_" + question_number + "_choise_" + index).value;
                choicess.push(choice);
                index++;
            }

            for (const radioButton of radioButtons) {
                if (radioButton.checked) {
                    correct_answer_index = radioButton.value;
                }
            }
            obj.correct = document.getElementById("quiz_" + question_number + "_choise_" + correct_answer_index).value;
            obj.choices = choicess;


            question_arr.push(obj);
        }



        // add quiz to fire store
        $(document).on('click', '#quiz_done', async function () {
            if (question_validation() == true) {
                if (radio_buttons_validation() == true) {
                    var question_id;
                    document.getElementById("quiz_validation").style.display = "none";
                    get_quiz_data();
                    // quiz set to fire store 
                    var Course_id = quiz_data.courseid;

                    const quiz_id = doc(collection(db, "courses", Course_id, "exams"));

                    const quizref = await setDoc((db, quiz_id), {
                        id: quiz_id.id,
                        courseId: Course_id,
                        name: quiz_data.name,
                        withTimer: quiz_data.timerbool,
                        timeInMinutes: quiz_data.time,
                        free: quiz_data.freebool,
                        date: new Date(),
                        canRepeat: quiz_data.repeatbool,
                    });

                    // loop throush each quition to add his data
                    for (let i = 0; i < question_number; i++) {
                        console.log(i);
                        console.log(question_arr);
                        question_id = doc(collection(db, "courses", Course_id, "exams", quiz_id.id, "questions"));
                        const cref = await setDoc((db, question_id), {
                            id: question_id.id,
                            question: question_arr[i].question,
                            options: question_arr[i].choices,
                            correctAnswer: question_arr[i].correct,
                            sortValue: i,
                        });

                    }

                    // set varibals of quiz to defualt 
                    current_choise_index = 1;
                    question_number = 1;
                    quiz_data = { courseid: "", name: "", repeatbool: false, timerbool: false, time: 0, freebool: false, date: new Date(), examtake: 0, quizcount: 0 };
                    question_arr = [];

                    var form = document.getElementById("quiz_elements")
                    var main_quiz_form = "<div class=\"form-group\" style=\"text-align:center ;\">"
                    main_quiz_form += "<label for=\"inputEmail4\">quiz title</label>"
                    main_quiz_form += "<input type=\"text\" class=\"form-control\" id=\"quiz_name\" placeholder=\"عنوان الامتحان\">"
                    main_quiz_form += "<p class=\"validation\" id=\"quiz_name_validation\">Quiz title must be filled out </p>"
                    main_quiz_form += "</div>"
                    main_quiz_form += "<div class=\"form-group\">"
                    main_quiz_form += "<div class=\"form-check\">"
                    main_quiz_form += "<input class=\"form-check-input\" type=\"checkbox\" value=\"false\" id=\"enroll\">"
                    main_quiz_form += "<label class=\"form-check-label\" for=\"flexCheckDefault\">"
                    main_quiz_form += "هل الامتحان يتطلب التسجيل بالكورس ؟  </label>"
                    main_quiz_form += "</div>"
                    main_quiz_form += "<div class=\"form-check\">"
                    main_quiz_form += "<input class=\"form-check-input\" type=\"checkbox\" value=\"false\" id=\"repeat\">"
                    main_quiz_form += "<label class=\"form-check-label\" for=\"flexCheckDefault\">"
                    main_quiz_form += "   هل يمكن اعادة الامتحان ؟ </label>"
                    main_quiz_form += "</div>"
                    main_quiz_form += "<div class=\"form-check\">"
                    main_quiz_form += "<input class=\"form-check-input\" type=\"checkbox\" value=\"true\" id=\"time\">"
                    main_quiz_form += "<label class=\"form-check-label\" for=\"flexCheckDefault\">"
                    main_quiz_form += "هل الامتحان وقت معين ؟</label>"
                    main_quiz_form += "</div>"
                    main_quiz_form += "</div>"
                    main_quiz_form += "<div class=\"form-group\" id=\"quiz_time_div\" style=\"text-align:center ;\">"
                    main_quiz_form += "<label for=\"inputEmail4\">Quiz time</label>"
                    main_quiz_form += "<input type=\"text\" class=\"form-control\" id=\"quiz_time\" placeholder=\"الوقت بالدقايق\">"
                    main_quiz_form += "<p class=\"validation\" id=\"quiz_time_validation\">Quiz Time must be filled out</p>"
                    main_quiz_form += "</div>"
                    main_quiz_form += "<div class=\"form-group\" id=\"grid\">"
                    main_quiz_form += "<button type=\"button\"  id=\"Next_quiz\" class=\"btn btn-primary\">Next</button>"
                    main_quiz_form += "</div>"
                    form.innerHTML = main_quiz_form;

                    var myModal = document.getElementById('exampleModalquiz')
                    window.upload_pdf = function () { return false; };
                    document.getElementById("myModal_quizzz").style.display = "none";
                    alert("تم اضافة الامتحان");

                }
                else {
                    document.getElementById("quiz_validation").innerHTML = "one check box at least must be cheacked";
                    document.getElementById("quiz_validation").style.display = "block";
                }
            }
            else {
                document.getElementById("quiz_validation").innerHTML = "All fields must be filled out";
                document.getElementById("quiz_validation").style.display = "block";
            }
        })



        //preview quiz handle
        const option_list = document.querySelector(".option_list");
        let timeValue = 15;
        let que_count = 0;
        let que_numb = 1;
        let userScore = 0;
        let counter;
        const result_box = document.querySelector(".result_box");
        const next_btn = document.getElementById("next_btn_quiz");
        const bottom_ques_counter = document.querySelector("footer .total_que");
        const timeCount = document.getElementById("time_left");
        const exit_quiz = document.getElementById("quit_quiz");
        exit_quiz.onclick = () => {
            const info_box = document.querySelector(".preview_quiz_info");
            info_box.style.display = "none";
            quiz_preview_data = { time: "", count: "", name: "", repeat: false, free: false, timer: false }
            question_arr_prev = [];
        }
        const exit_quiz2 = document.getElementById("quiz_end");
        exit_quiz2.onclick = () => {
            const info_box = document.querySelector(".preview_quiz_res");
            info_box.style.display = "none";
        }
        const start_quiz = document.getElementById("start_quiz")
        start_quiz.onclick = () => {
            const info_box = document.querySelector(".preview_quiz_info");
            info_box.style.display = "none";
            const quiz_box = document.querySelector(".preview_quiz_box");
            quiz_box.style.display = "block";
            showQuetions(0); //calling showQestions function
            queCounter(1); //passing 1 parameter to queCounter
            startTimer(quiz_preview_data.time); //calling startTimer function

        }
        const end_quiz = document.getElementById("quit_score")
        end_quiz.onclick = () => {
            showResult();
        }
        next_btn.onclick = () => {
            if (que_count < question_arr_prev.length - 1) { //if question count is less than total question length
                que_count++; //increment the que_count value
                que_numb++; //increment the que_numb value
                showQuetions(que_count); //calling showQestions function
                queCounter(que_numb); //passing que_numb value to queCounter
                next_btn.style.display = "none";
            } else {
                clearInterval(counter); //clear counter
                showResult(); //calling showResult function
            }
        }
        $(document).on('click', '.quizpopup', async function () {
            let Course_id = sessionStorage.getItem("lec_id");
            let quiz_id = sessionStorage.getItem("quiz_id");
            const quiz_query = query(collection(db, "courses", Course_id, "exams"), where("id", "==", quiz_id));
            let quiz_data = await retrivequiers(quiz_query);
            await getquizdata();
            document.getElementById("quiz_prev_title").innerHTML = quiz_preview_data.name;
            if (quiz_data[0].timeInMinutes == 0) {
                document.getElementById("quiz_info_time").innerHTML = "1. This quiz with no time limt"
                document.getElementById("quiz_prev_timer").display = "none";

            }
            else {
                document.getElementById("quiz_prev_timer").display = "block";
                document.getElementById("quiz_info_time").innerHTML = "1. You will have only <span>" + quiz_data[0].timeInMinutes + "</span> minutes to finish"
            }
        });
        async function getquizdata() {
            let quiz_id = sessionStorage.getItem("quiz_id");
            let Course_id = sessionStorage.getItem("lec_id");
            const quiz_query = query(collection(db, "courses", Course_id, "exams"), where("id", "==", quiz_id));
            let quiz_data = await retrivequiers(quiz_query);
            quiz_preview_data.time = quiz_data[0].timeInMinutes;
            quiz_preview_data.count = quiz_data[0].questionCount;
            quiz_preview_data.name = quiz_data[0].name;
            quiz_preview_data.free = quiz_data[0].free;
            quiz_preview_data.repeat = quiz_data[0].canRepeat;
            quiz_preview_data.timer = quiz_data[0].withTimer;
            const questions_query = query(collection(db, "courses", Course_id, "exams", quiz_id, "questions"));
            let questions_data = await retrivequiers(questions_query);
            questions_data.forEach((ques) => {
                var obj = {};
                obj.correct = ques.correctAnswer;
                obj.question = ques.question;
                obj.index = ques.sortValue + 1;
                obj.options = ques.options;
                obj.id = ques.id;
                question_arr_prev.push(obj);
            });
            console.log(question_arr_prev);

        }
        function showQuetions(index) {
            const que_text = document.querySelector(".que_text");
            var option_tag = ""
            //creating a new span and div tag for question and option and passing the value using array index
            let que_tag = '<span>' + parseInt(index + 1) + ". " + question_arr_prev[index].question + '</span>';
            question_arr_prev[index].options.forEach((option) => {
                option_tag += '<div class="option"><span>' + option + '</span></div>';
            })

            que_text.innerHTML = que_tag; //adding new span tag inside que_tag
            option_list.innerHTML = option_tag; //adding new div tag inside option_tag

            const option = option_list.querySelectorAll(".option");
            // set onclick attribute to all available options

        }
        let tickIconTag = '<div class="icon tick"><i class="fas fa-check"></i></div>';
        let crossIconTag = '<div class="icon cross"><i class="fas fa-times"></i></div>';
        //if user clicked on option
        $(document).on('click', '.option', function () {


            let userAns = this.textContent; //getting user selected option
            let correcAns = question_arr_prev[que_count].correct; //getting correct answer from array
            console.log(correcAns);
            const allOptions = option_list.children.length; //getting all option items

            if (userAns == correcAns) { //if user selected option is equal to array's correct answer
                userScore += 1; //upgrading score value with 1
                this.classList.add("correct"); //adding green color to correct selected option
                this.insertAdjacentHTML("beforeend", tickIconTag); //adding tick icon to correct selected option
                console.log("Correct Answer");
                console.log("Your correct answers = " + userScore);
            } else {
                this.classList.add("incorrect"); //adding red color to correct selected option
                this.insertAdjacentHTML("beforeend", crossIconTag); //adding cross icon to correct selected option
                console.log("Wrong Answer");
                for (let i = 0; i < allOptions; i++) {
                    if (option_list.children[i].textContent == correcAns) { //if there is an option which is matched to an array answer 
                        option_list.children[i].setAttribute("class", "option correct"); //adding green color to matched option
                        option_list.children[i].insertAdjacentHTML("beforeend", tickIconTag); //adding tick icon to matched option
                        console.log("Auto selected correct answer.");
                    }
                }
            }
            for (let i = 0; i < allOptions; i++) {
                option_list.children[i].classList.add("disabled"); //once user select an option then disabled all options
            }
            next_btn.style.display = "block"; //show the next button if user selected any option

        })
        function showResult() {
            clearInterval(counter); //clear counter
            const quiz_box = document.querySelector(".preview_quiz_box");
            quiz_box.style.display = "none";
            const res_box = document.querySelector(".preview_quiz_res");
            res_box.style.display = "block";
            const scoreText = result_box.querySelector(".score_text");
            document.getElementById("your_Score").innerHTML = userScore;
            document.getElementById("total_score").innerHTML = question_arr_prev.length;
            timeValue = 15;
            que_count = 0;
            que_numb = 1;
            userScore = 0;
            counter;
            quiz_preview_data = { time: "", count: "", name: "", repeat: false, free: false, timer: false }
            question_arr_prev = [];

        }
        function startTimer(time) {
            timeCount.innerHTML = time;
            counter = setInterval(timer, 60 * 1000);
            function timer() {
                timeCount.innerHTML = time; //changing the value of timeCount with time value
                time--; //decrement the time value

                if (time < 0) { //if timer is less than 0
                    clearInterval(counter); //clear counter

                    const allOptions = option_list.children.length; //getting all option items
                    let correcAns = question_arr_prev[que_count].answer; //getting correct answer from array
                    for (let i = 0; i < allOptions; i++) {
                        if (option_list.children[i].textContent == correcAns) { //if there is an option which is matched to an array answer
                            option_list.children[i].setAttribute("class", "option correct"); //adding green color to matched option
                            option_list.children[i].insertAdjacentHTML("beforeend", tickIconTag); //adding tick icon to matched option
                            console.log("Time Off: Auto selected correct answer.");
                        }
                    }
                    for (let i = 0; i < allOptions; i++) {
                        option_list.children[i].classList.add("disabled"); //once user select an option then disabled all options
                    }
                    showResult()
                }
            }
        }
        function queCounter(index) {
            //creating a new span tag and passing the question number and total question
            let totalQueCounTag = '<span><p>' + index + '</p> of <p>' + question_arr_prev.length + '</p> Questions</span>';
            bottom_ques_counter.innerHTML = totalQueCounTag;  //adding new span tag inside bottom_ques_counter
        }

        //Edit quiz yalhway


        var modal_quiz_edit = document.getElementById("myModal_quiz_edit");
        // Get the button that opens the modal

        // Get the <span> element that closes the modal
        var span_quiz_edit = document.getElementsByClassName("close_quiz_edit")[0];
        // When the user clicks on the button, open the modal

        // When the user clicks on <span> (x), close the modal
        span_quiz_edit.onclick = function () {
            modal_quiz_edit.style.display = "none";
            quiz_preview_data = { time: "", count: "", name: "", repeat: false, free: false, timer: false }
            question_arr_prev = [];
        }
        // When the user clicks anywhere outside of the modal, close it


        window.onclick = function (event) {
            if (event.target == modal_quiz_edit) {
                modal_quiz_edit.style.display = "none";
                quiz_preview_data = { time: "", count: "", name: "", repeat: false, free: false, timer: false }
                question_arr_prev = [];
            }
        }

        $(document).on('click', '.editquiz', async function () {
            var modal_edit_quiz = document.getElementById("myModal_quiz_edit");
            modal_edit_quiz.style.display = "block";
            document.getElementById("quiz_edit_elements").innerHTML = renderedit_quiz();
            var current_quiz_id = sessionStorage.getItem("quiz_id");
            quiz_preview_data = { time: "", count: "", name: "", repeat: false, free: false, timer: false }
            question_arr_prev = [];
            await getquizdata();
            console.log(quiz_preview_data);
            if (quiz_preview_data.time != 0) {
                document.getElementById("quiz_time_div_edit").style.display = "block";
                document.getElementById("quiz_time_edit").value = quiz_preview_data.time;

            }
            else {
                document.getElementById("quiz_time_div_edit").style.display = "none";
            }
            document.getElementById("quiz_name_edit").value = quiz_preview_data.name;

            var free = quiz_preview_data.free;
            var timer = quiz_preview_data.timer;
            var repeat = quiz_preview_data.repeat;
            if (free == true) {
                document.getElementById("enroll_edit").checked = true;
                document.getElementById("enroll_edit").value = true;
            }
            else {
                document.getElementById("enroll_edit").checked = false;
                document.getElementById("enroll_edit").value = false;
            }
            if (timer == true) {
                document.getElementById("time_edit").checked = true;
                document.getElementById("time_edit").value = true;
            }
            else {
                document.getElementById("time_edit").checked = false;
                document.getElementById("time_edit").value = false;
            }
            if (repeat == true) {
                document.getElementById("repeat_edit").checked = true;
                document.getElementById("repeat_edit").value = true;
            }
            else {
                document.getElementById("repeat_edit").checked = false;
                document.getElementById("repeat_edit").value = false;
            }

        })

        $(document).on('click', '.question_div', async function () {
            current_choise_index_edit = 1
            let Course_id = sessionStorage.getItem("lec_id");
            let quiz_id = sessionStorage.getItem("quiz_id");
            let question_id = this.id
            sessionStorage.setItem("question_id",question_id)
            const question_course_query = query(collection(db, "courses", Course_id, "exams", quiz_id, "questions"), where("id", "==", question_id));
            let question_data = await retrivequiers(question_course_query);
            console.log(question_data);
            var quiz = "<div class=\"form-group\" style=\"text-align:center ;\">"
            quiz += "<input type=\"text\" class=\"form-control\" id=\"question_edit\" value=\" " + question_data[0].question + "\" placeholder=\"سؤال\">"
            quiz += "</div>"
            quiz += "<h4 class=\"right\">choices</h4>"
            quiz += "<fieldset id=\"choices_edit\" class=\"form-group\">"
            question_data[0].options.forEach((ques) => {
                quiz += "<div class=\"form-check flex\">"
                quiz += "<input type=\"text\" class=\"form-control\" id=\"quiz_choise_" + current_choise_index_edit + "\" value=\"" + ques + "\" placeholder=\"اختيار\">"
                if (question_data[0].correctAnswer == ques) {
                    quiz += "<input class=\"form-check-input\" type=\"radio\" name=\"gridRadios\" id=\"quiz_check_" + current_choise_index_edit + "\" value=\"" + current_choise_index_edit + "\" checked>"
                }
                else {
                    quiz += "<input class=\"form-check-input\" type=\"radio\" name=\"gridRadios\" id=\"quiz_check_" + current_choise_index_edit + "\" value=\"" + current_choise_index_edit + "\">"
                }
                quiz += "</div>"


                current_choise_index_edit++;
            });

            quiz += "</fieldset>"
            quiz += "<a href=\"#\" id=\"add_choices_edit\" class=\"ahref\">اضافة اختيار <span class=\"material-symbols-sharp\">add</span></a>"
            quiz += "<p class=\"validation\" id=\"quiz_validation_edit\">All fields must be filled out</p>"
            quiz += "<div class=\"centertwo\">"
            quiz += "<button type=\"button\"  id=\"quiz_edit_back2\" class=\"btn btn-primary\">Back</button>"
            quiz += "<button id=\"update_back2\" type=\"button\"  class=\"btn btn-primary\">Update Question</button>"
            quiz += "</div>"
            document.getElementById("quiz_edit_elements").innerHTML = quiz;
        })

        $(document).on('click', '#edit_questions', async function () {
            quiz_preview_data = { time: "", count: "", name: "", repeat: false, free: false, timer: false }
            question_arr_prev = [];
            await getquizdata();
            var question = "<h2 class=\"title_edit_quiz\"> <span id=\"add_quiz_edit\" class=\"material-symbols-sharp\">add</span>تعديل واضافة اسئلة</h2>"

            question_arr_prev.forEach((ques) => {
                question += "<div id=\"" + ques.id + "\" class=\"question_div\">"
                question += " <p>" + ques.question + "</p>"
                question += "</div>";
            });
            question += "<div class=\"form-group\" id=\"grid\"><button type=\"button\" id=\"back_edit_quiz\" class=\"btn btn-primary\">Back</button></div>"
            document.getElementById("quiz_edit_elements").innerHTML = question;
        })
        function renderedit_quiz() {
            var quiz_Edit_html = "<div class=\"form-group\" style=\"text-align:center ;\">"
            quiz_Edit_html += "<label for=\"inputEmail4\">quiz title</label>"
            quiz_Edit_html += "<input type=\"text\" class=\"form-control\" id=\"quiz_name_edit\" placeholder=\"عنوان الامتحان\">"
            quiz_Edit_html += " <p class=\"validation\" id=\"quiz_name_validation_edit\">Quiz title must be filled out</p>"
            quiz_Edit_html += "</div>"
            quiz_Edit_html += "<div class=\"form-group\" id=\"quiz_time_div_edit\" style=\"text-align:center ;\">"
            quiz_Edit_html += "<label for=\"inputEmail4\">Quiz time</label>"
            quiz_Edit_html += "<input type=\"text\" class=\"form-control\" id=\"quiz_time_edit\" placeholder=\"الوقت بالدقايق\">"
            quiz_Edit_html += "<p class=\"validation\" id=\"quiz_time_validation_edit\">Quiz Time must be filled out </p></div>"
            quiz_Edit_html += "<div class=\"form-group\">"
            quiz_Edit_html += "<div class=\"form-check\">"
            quiz_Edit_html += "<input class=\"form-check-input\" type=\"checkbox\" value=\"false\" id=\"enroll_edit\">"
            quiz_Edit_html += " <label class=\"form-check-label\" for=\"flexCheckDefault\">هل الامتحان يتطلب التسجيل بالكورس ؟</label>"
            quiz_Edit_html += "</div>"
            quiz_Edit_html += "<div class=\"form-check\">"
            quiz_Edit_html += "<input class=\"form-check-input\" type=\"checkbox\" value=\"true\" id=\"repeat_edit\">"
            quiz_Edit_html += "<label class=\"form-check-label\" for=\"flexCheckDefault\"> هل يمكن اعادة الامتحان ؟</label>"
            quiz_Edit_html += "</div>"
            quiz_Edit_html += "<div class=\"form-check\">"
            quiz_Edit_html += "<input class=\"form-check-input\" type=\"checkbox\" value=\"true\" id=\"time_edit\">"
            quiz_Edit_html += "<label class=\"form-check-label\" for=\"flexCheckDefault\">"
            quiz_Edit_html += "  هل الامتحان وقت معين ؟"
            quiz_Edit_html += " </label> </div>  </div>"
            quiz_Edit_html += " <div class=\"form-group\" id=\"flex_between\">"
            quiz_Edit_html += "<button type=\"button\" id=\"edit_questions\" class=\"btn btn-primary\">EditQuestions</button>"
            quiz_Edit_html += " <button type=\"button\" id=\"update_quiz\" class=\"btn btn-primary\">Save</button> </div>"
            return quiz_Edit_html;
        }
        $(document).on('click', '#back_edit_quiz', async function () {

            var modal_edit_quiz = document.getElementById("myModal_quiz_edit");
            modal_edit_quiz.style.display = "block";
            document.getElementById("quiz_edit_elements").innerHTML = renderedit_quiz();
            var current_quiz_id = sessionStorage.getItem("quiz_id");
            quiz_preview_data = { time: "", count: "", name: "", repeat: false, free: false, timer: false }
            question_arr_prev = [];
            await getquizdata();
            console.log(quiz_preview_data);
            if (quiz_preview_data.time != 0) {
                document.getElementById("quiz_time_div_edit").style.display = "block";
                document.getElementById("quiz_time_edit").value = quiz_preview_data.time;

            }
            else {
                document.getElementById("quiz_time_div_edit").style.display = "none";
            }
            document.getElementById("quiz_name_edit").value = quiz_preview_data.name;

            var free = quiz_preview_data.free;
            var timer = quiz_preview_data.timer;
            var repeat = quiz_preview_data.repeat;
            if (free == true) {
                document.getElementById("enroll_edit").checked = true;
                document.getElementById("enroll_edit").value = true;
            }
            else {
                document.getElementById("enroll_edit").checked = false;
                document.getElementById("enroll_edit").value = false;
            }
            if (timer == true) {
                document.getElementById("time_edit").checked = true;
                document.getElementById("time_edit").value = true;
            }
            else {
                document.getElementById("time_edit").checked = false;
                document.getElementById("time_edit").value = false;
            }
            if (repeat == true) {
                document.getElementById("repeat_edit").checked = true;
                document.getElementById("repeat_edit").value = true;
            }
            else {
                document.getElementById("repeat_edit").checked = false;
                document.getElementById("repeat_edit").value = false;
            }
        })

        $(document).on('click', '#add_quiz_edit', async function () {

            current_choise_index_edit = 1
            var quiz = "<div class=\"form-group\" style=\"text-align:center ;\">"
            quiz += "<input type=\"text\" class=\"form-control\" id=\"question_edit\" placeholder=\"سؤال\">"
            quiz += "</div>"
            quiz += "<h4 class=\"right\">choices</h4>"
            quiz += "<fieldset id=\"choices_edit\" class=\"form-group\">"
            quiz += "<div class=\"form-check flex\">"
            quiz += "<input type=\"text\" class=\"form-control\" id=\"quiz_choise_" + current_choise_index_edit + "\" placeholder=\"اختيار\">"
            quiz += "<input class=\"form-check-input\" type=\"radio\" name=\"gridRadios\" id=\"quiz_check_" + current_choise_index_edit + "\" value=\"" + current_choise_index_edit + "\">"
            quiz += "</div>"
            current_choise_index_edit++;
            quiz += "<div class=\"form-check flex\">"
            quiz += "<input type=\"text\" class=\"form-control\" id=\"quiz_choise_" + current_choise_index_edit + "\" placeholder=\"اختيار\">"
            quiz += "<input class=\"form-check-input\" type=\"radio\" name=\"gridRadios\" id=\"quiz_check_" + current_choise_index_edit + "\" value=\"" + current_choise_index_edit + "\">"
            quiz += "</div>"
            current_choise_index_edit++;
            quiz += "</fieldset>"
            quiz += "<a href=\"#\" id=\"add_choices_edit\" class=\"ahref\">اضافة اختيار <span class=\"material-symbols-sharp\">add</span></a>"
            quiz += "<p class=\"validation\" id=\"quiz_validation_edit\">All fields must be filled out</p>"
            quiz += "<div class=\"centertwo\">"
            quiz += "<button type=\"button\"  id=\"quiz_edit_back2\" class=\"btn btn-primary\">Back</button>"
            quiz += "<button id=\"add_back2\" type=\"button\"  class=\"btn btn-primary\">Add Question</button>"
            quiz += "</div>"
            document.getElementById("quiz_edit_elements").innerHTML = quiz;
        })
        $(document).on('click', '#add_choices_edit', function () {
            add_checkbox_edit();
        })
        function add_checkbox_edit() {


            var fieldset = document.getElementById("choices_edit");

            const div = document.createElement("div");
            div.setAttribute("class", "form-check flex");

            const input_text = document.createElement("input");
            input_text.setAttribute("type", "text");
            input_text.setAttribute("class", "form-control");
            input_text.setAttribute("placeholder", "اختيار");
            input_text.setAttribute("id", "quiz_choise_" + current_choise_index_edit);
            div.appendChild(input_text);

            const input_check = document.createElement("input");
            input_check.setAttribute("type", "radio");
            input_check.setAttribute("class", "form-check-input");
            input_check.setAttribute("name", "gridRadios");
            input_check.setAttribute("value", current_choise_index_edit);
            input_check.setAttribute("id", "quiz_check_" + current_choise_index_edit);
            div.appendChild(input_check);
            fieldset.appendChild(div);

            current_choise_index_edit++;
        }

        $(document).on('click', '#quiz_edit_back2', async function () {
            quiz_preview_data = { time: "", count: "", name: "", repeat: false, free: false, timer: false }
            question_arr_prev = [];
            await getquizdata();
            var question = "<h2 class=\"title_edit_quiz\"> <span id=\"add_quiz_edit\" class=\"material-symbols-sharp\">add</span>تعديل واضافة اسئلة</h2>"

            question_arr_prev.forEach((ques) => {
                question += "<div id=\"" + ques.id + "\" class=\"question_div\">"
                question += " <p>" + ques.question + "</p>"
                question += "</div>";
            });
            question += "<div class=\"form-group\" id=\"grid\"><button type=\"button\" id=\"back_edit_quiz\" class=\"btn btn-primary\">Back</button></div>"
            document.getElementById("quiz_edit_elements").innerHTML = question;
        })

        $(document).on('click', '#update_back2', async function () {
            if (question_validation_edit() == true) {
                if (radio_buttons_validation() == true) {
                    document.getElementById("quiz_validation_edit").style.display = "none";
                    let Course_id = sessionStorage.getItem("lec_id");
                    let quiz_id = sessionStorage.getItem("quiz_id");
                    let question_id = sessionStorage.getItem("question_id");
                    var answers = new Array();
                    var index = 1;
                    var correct_answer_index;
                    const radioButtons = document.querySelectorAll('input[name="gridRadios"]');

                    var question = document.getElementById("question_edit").value;
                    for (let i = 0; i < current_choise_index_edit - 1; i++) {
                    var choice = document.getElementById("quiz_choise_" + index).value;
                    answers.push(choice);
                    index++;
                    }
                    
                    for (const radioButton of radioButtons) {
                     if (radioButton.checked) {
                         correct_answer_index = radioButton.value;
                     }   
                  }
                  const questionRef = doc(db, "courses", Course_id, "exams", quiz_id, "questions",question_id);
                 var correct = document.getElementById("quiz_choise_"+correct_answer_index).value;
                 await updateDoc(questionRef, {
                    correctAnswer:correct,
                    options:answers,
                    question:question,
                });
               
                    


            quiz_preview_data = { time: "", count: "", name: "", repeat: false, free: false, timer: false }
            question_arr_prev = [];
            await getquizdata();
            var question = "<h2 class=\"title_edit_quiz\"> <span id=\"add_quiz_edit\" class=\"material-symbols-sharp\">add</span>تعديل واضافة اسئلة</h2>"

            question_arr_prev.forEach((ques) => {
                question += "<div id=\"" + ques.id + "\" class=\"question_div\">"
                question += " <p>" + ques.question + "</p>"
                question += "</div>";
            });
            question += "<div class=\"form-group\" id=\"grid\"><button type=\"button\" id=\"back_edit_quiz\" class=\"btn btn-primary\">Back</button></div>"
            document.getElementById("quiz_edit_elements").innerHTML = question;
            alert("تم تعديل السؤال بنجاح");
                }
                else {
                    document.getElementById("quiz_validation_edit").innerHTML = "one check box at least must be cheacked";
                    document.getElementById("quiz_validation_edit").style.display = "block";
                }
            }
            else {
                document.getElementById("quiz_validation_edit").innerHTML = "All fields must be filled out";
                document.getElementById("quiz_validation_edit").style.display = "block";
            }

        })

        $(document).on('click', '#add_back2', async function () {

            if (question_validation_edit() == true) {
                if (radio_buttons_validation() == true) {
                    document.getElementById("quiz_validation_edit").style.display = "none";
                    let Course_id = sessionStorage.getItem("lec_id");
                    let quiz_id = sessionStorage.getItem("quiz_id");
                    var answers = new Array();
                    var index = 1;
                    var correct_answer_index;
                    const radioButtons = document.querySelectorAll('input[name="gridRadios"]');

                    var question = document.getElementById("question_edit").value;
                    for (let i = 0; i < current_choise_index_edit - 1; i++) {
                    var choice = document.getElementById("quiz_choise_" + index).value;
                    answers.push(choice);
                    index++;
                    }
                    
                    for (const radioButton of radioButtons) {
                     if (radioButton.checked) {
                         correct_answer_index = radioButton.value;
                     }   
                  }
                 var correct = document.getElementById("quiz_choise_"+correct_answer_index).value;
                 const question_course_query = query(collection(db, "courses", Course_id, "exams", quiz_id, "questions"));
                 let question_data = await retrivequiers(question_course_query);
                 var sort= parseInt(question_data.length+1);
                 
                 const questionRef = await addDoc(collection(db, "courses", Course_id, "exams", quiz_id, "questions"), {
                    correctAnswer:correct,
                    options:answers,
                    question:question,
                    sortValue:sort,
                    });
                    const washingtonRef = doc(db, "courses", Course_id, "exams", quiz_id, "questions" , questionRef.id);
                    await updateDoc(washingtonRef, {
                        id: questionRef.id
                        });
            quiz_preview_data = { time: "", count: "", name: "", repeat: false, free: false, timer: false }
            question_arr_prev = [];
            await getquizdata();
            var question = "<h2 class=\"title_edit_quiz\"> <span id=\"add_quiz_edit\" class=\"material-symbols-sharp\">add</span>تعديل واضافة اسئلة</h2>"

            question_arr_prev.forEach((ques) => {
                question += "<div id=\"" + ques.id + "\" class=\"question_div\">"
                question += " <p>" + ques.question + "</p>"
                question += "</div>";
            });
            question += "<div class=\"form-group\" id=\"grid\"><button type=\"button\" id=\"back_edit_quiz\" class=\"btn btn-primary\">Back</button></div>"
            document.getElementById("quiz_edit_elements").innerHTML = question;
            alert("تم اضافة السؤال بنجاح");
                }
                else {
                    document.getElementById("quiz_validation_edit").innerHTML = "one check box at least must be cheacked";
                    document.getElementById("quiz_validation_edit").style.display = "block";
                }
            }
            else {
                document.getElementById("quiz_validation_edit").innerHTML = "All fields must be filled out";
                document.getElementById("quiz_validation_edit").style.display = "block";
            }


        })

        function question_validation_edit() {

            var question_value = document.getElementById("question_edit").value;
            var answers = new Array();
            var index = 1;


        for (let i = 0; i < current_choise_index_edit - 1; i++) {

             var choice = document.getElementById("quiz_choise_" + index).value;
             answers.push(choice);
             index++;
            }


            for (var i = 0; i < answers.length; i++) {
                if (answers[i] === "") {
                 document.getElementById("quiz_validation_edit").style.display = "block";
                 return false;
                 }
             }
             
            if (question_value == "") {
              document.getElementById("quiz_validation_edit").style.display = "block";
              return false;
                }
            document.getElementById("quiz_validation_edit").style.display = "none";
            return true;

            }


        $(document).on('click', '#update_quiz', async function () {
            var quiz_name_value = document.getElementById("quiz_name_edit").value;
            var time_value;
            var time_Check = document.getElementById("time_edit");
            CheckBox(time_Check);
            var time_check_bool = (time_Check.value === "true");

            var enroll_Check = document.getElementById("enroll_edit");
            CheckBox(enroll_Check);
            var enroll_Check_bool = (enroll_Check.value === "true");

            var repeat_Check = document.getElementById("repeat_edit");
            CheckBox(repeat_Check);
            var repeat_Check_bool = (repeat_Check.value === "true");
            let Course_id = sessionStorage.getItem("lec_id");
            let quiz_id = sessionStorage.getItem("quiz_id");

            if (quiz_name_value != "" && validate_quiz_time_edit() == true) {
                const checkbox = document.getElementById('time_edit');
                if(checkbox.checked){
                    time_value =parseInt(document.getElementById("quiz_time_edit").value);
                }
                else{
                    time_value=0
                }
                const quiz_ref = doc(db, "courses", Course_id, 'exams', quiz_id);
                await updateDoc(quiz_ref, {
                    canRepeat:repeat_Check_bool,
                    free:enroll_Check_bool,
                    withTimer:time_check_bool,
                    name:quiz_name_value,
                    timeInMinutes:time_value,
                });

            }
            else {
            if (quiz_name_value != "") {
            document.getElementById("quiz_name_validation_edit").style.display = "none";
            } 
            else {
                document.getElementById("quiz_name_validation_edit").style.display = "block";
                }

            }
            alert("تم تعديل الامتحان بنجاح");
        })
        function validate_quiz_time_edit() {

            const checkbox = document.getElementById('time_edit');
            const quiz_time_value = document.getElementById("quiz_time_edit").value;
            if (checkbox.checked) {

                if (quiz_time_value != "") {

                    var valueInt = parseInt(quiz_time_value)
                    console.log(valueInt);
                    if (valueInt < 5 || valueInt > 100) {

                        document.getElementById("quiz_time_validation_edit").innerHTML = " وقت للامتحان يتراوج من 5 دقائق الي 100 دقيقة";
                        document.getElementById("quiz_time_validation_edit").style.display = "block";
                        return false;
                    }
                    else {

                        return true;
                    }
                } else {

                    document.getElementById("quiz_time_validation").innerHTML = "Quiz Time must be filled out";
                    document.getElementById("quiz_time_validation").style.display = "block"
                    return false;
                }
            }
            else {

                return true;
            }
        }

    </script>

</body>

</html>